(()=>{const createElement=(e,t={},...n)=>{const a=document.createElement(e);for(let[e,n]of Object.entries(t))"class"===e?a.className=n:"style"===e?Object.assign(a.style,n):e.startsWith("on")&&"function"==typeof n?a.addEventListener(e.slice(2).toLowerCase(),n):"checked"===e?a.checked=n:a.setAttribute(e,n);return n.forEach((e=>{"string"==typeof e?a.appendChild(document.createTextNode(e)):e&&a.appendChild(e)})),a},channelCategories=[{name:"General",channels:[{id:"notes1",name:"Notes",type:"notes"}]},{name:"Learning",channels:[{id:"flashcard1",name:"Flashcards",type:"flashcard"},{id:"whiteboard1",name:"Whiteboard",type:"whiteboard"}]},{name:"Utilities",channels:[{id:"code1",name:"Code Runner",type:"code"},{id:"crypt1",name:"Crypt",type:"crypt"}]},{name:"Reminders",channels:[{id:"reminder1",name:"Reminders",type:"reminder"}]},{name:"Files",channels:[{id:"files1",name:"Files",type:"files"}]},{name:"Settings",channels:[{id:"settings",name:"Settings",type:"settings"}]}],chatMessages={},flashcards={},reminders={};window.whiteboardData=window.whiteboardData||{},window.codeData=window.codeData||{};const readFileAsync=e=>new Promise((t=>{const n=new FileReader;n.onload=n=>t({name:e.name,type:e.type,content:n.target.result}),e.type.startsWith("image/")||e.type.startsWith("video/")||e.type.startsWith("audio/")||"application/pdf"===e.type?n.readAsDataURL(e):n.readAsText(e)})),renderSidebar=()=>{const e=document.querySelector(".topbar");e.innerHTML="",channelCategories.forEach((t=>{const n=createElement("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"}}),a=createElement("div",{class:"channel-list"});t.channels.forEach((e=>{const t=createElement("div",{class:"channel-item","data-channel-id":e.id,"data-channel-type":e.type,oncontextmenu:n=>{if(n.preventDefault(),"function"===e.type){t.textContent="Remove",t.classList.add("remove-btn"),t.title="Click to remove";const n=a=>{a.stopPropagation();const l=channelCategories.find((e=>"Functions"===e.name));l&&(l.channels=l.channels.filter((t=>t.id!==e.id)),renderSidebar()),t.removeEventListener("click",n)},a=l=>{l.target!==t&&(t.classList.remove("remove-btn"),t.title="",t.textContent=e.name,t.removeEventListener("click",n),document.removeEventListener("click",a))};t.addEventListener("click",n),document.addEventListener("click",a)}},onclick:()=>{if("function"===e.type){const t=channelCategories.flatMap((e=>e.channels)).find((e=>"code"===e.type));t&&(window.codeData[t.id]=e.code,selectChannel(t))}else selectChannel(e)}},e.name);a.appendChild(t)})),n.appendChild(a),e.appendChild(n)})),e.appendChild(createElement("div",{class:"version-text",style:{marginLeft:"auto",padding:"0 1rem"}},"v1.40"))};let activeChannelId=null;const selectChannel=e=>{activeChannelId=e.id,document.querySelectorAll(".channel-item").forEach((e=>{e.classList.toggle("active-channel",e.getAttribute("data-channel-id")===activeChannelId)})),renderChannel(e)},renderChannel=e=>{const t=document.querySelector(".main-content");t.innerHTML="";({notes:()=>renderNotesChannel(t,e),flashcard:()=>renderFlashcardChannel(t,e),whiteboard:()=>renderWhiteboardChannel(t,e),code:()=>renderCodeChannel(t,e),reminder:()=>renderReminderChannel(t,e),crypt:()=>renderCryptChannel(t,e),settings:()=>renderSettingsChannel(t,e),files:()=>renderFilesChannel(t,e)}[e.type]||(()=>{}))()},renderNotesChannel=(e,t)=>{e.innerHTML="",Object.assign(e.style,{display:"flex",flexDirection:"column",height:"100%"});const n=createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"}});e.appendChild(n);const a=createElement("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center"}});let l=!1;const o=createElement("button",{type:"button",onclick:()=>{l=!l,h.contentEditable=!l,o.textContent=l?"Edit Mode":"Read Mode"}},"Read Mode"),r=createElement("input",{type:"file",multiple:!0,style:{display:"none"}}),i=createElement("button",{type:"button",onclick:()=>r.click()},"Attach File"),s=createElement("button",{type:"button",disabled:!0,onclick:()=>{if("true"!==h.contentEditable)return;const e=window.getSelection();if(0===e.rangeCount||!h.contains(e.anchorNode))return;const t=e.toString();if(""===t.trim())return;const n=prompt("Enter the URL to link to:");if(!n)return;const a=document.createElement("a");a.href=n,a.textContent=t,a.target="_blank",a.rel="noopener noreferrer";const l=e.getRangeAt(0);l.deleteContents(),l.insertNode(a),e.removeAllRanges();const o=document.createRange();o.setStartAfter(a),o.setEndAfter(a),e.addRange(o)}},"Linkify");document.addEventListener("selectionchange",(()=>{""!==window.getSelection().toString().trim()?s.disabled=!1:s.disabled=!0})),a.appendChild(o),a.appendChild(r),a.appendChild(i),a.appendChild(s);const c=createElement("div",{style:{display:"flex",marginLeft:"auto"}}),d=createElement("button",{type:"button",onclick:()=>{const e={html:h.innerHTML,files:m},n=new Blob([JSON.stringify(e)],{type:"application/json"});createElement("a",{href:URL.createObjectURL(n),download:`${t.id}_notepad.json`}).click()}},"Export"),p=createElement("input",{type:"file",accept:"application/json",style:{display:"none"},onchange:async e=>{const t=e.target.files[0];if(!t)return;const n=await readFileAsync(t);try{const e=JSON.parse(n.content);h.innerHTML=e.html||"",m=e.files||[]}catch{}}}),u=createElement("button",{type:"button",onclick:()=>p.click()},"Import");c.appendChild(d),c.appendChild(p),c.appendChild(u),n.appendChild(a),n.appendChild(c);const h=createElement("div",{class:"notepad-content",contentEditable:!0,style:{flex:"1",border:"none",padding:"15px",background:"var(--color-primary)",outline:"none",overflow:"auto",margin:"var(--margin-small)",borderRadius:"var(--border-radius-small)"}});e.appendChild(h);let m=[];const A=async e=>{const t=document.querySelector(".notepad-content"),n=window.getSelection(),a=document.createElement("span");if(a.contentEditable="false",a.style.display="block",a.style.margin="5px 0",e.type.startsWith("image/")){const t=document.createElement("img");t.src=e.content,t.style.maxWidth="300px",t.alt=e.name,a.appendChild(t)}else if(e.type.startsWith("video/")){const t=document.createElement("video");t.src=e.content,t.controls=!0,t.style.maxWidth="400px",a.appendChild(t)}else if(e.type.startsWith("audio/")){const t=document.createElement("audio");t.src=e.content,t.controls=!0,t.style.width="300px",t.style.colorScheme="dark",a.appendChild(t)}else if("application/pdf"===e.type){const t=document.createElement("iframe");t.src=e.content,t.style.width="300px",t.style.height="500px",t.title=e.name,a.appendChild(t)}else{const t=document.createElement("div");t.style.display="inline-block",t.style.maxWidth="300px",t.style.maxHeight="200px",t.style.overflow="auto",t.style.background="var(--color-accent)",t.style.padding="10px",t.style.borderRadius="var(--border-radius-small)";const n=document.createElement("div");n.textContent=e.name,t.appendChild(n);const l=document.createElement("pre");l.textContent=e.content,l.style.margin="0",l.style.whiteSpace="pre-wrap",l.style.wordWrap="break-word",t.appendChild(l),a.appendChild(t)}let l;if(n.rangeCount>0&&t.contains(n.anchorNode)){l=n.getRangeAt(0),l.deleteContents();const{startContainer:e,startOffset:t}=l,o=e.nodeType===Node.TEXT_NODE?e.previousSibling:e.childNodes[t-1];(t>0||e.nodeType===Node.TEXT_NODE&&e.textContent.trim()||o&&"BR"!==o.nodeName&&"SPAN"!==o.nodeName)&&l.insertNode(document.createElement("br")),l.insertNode(a);const r=a.nextSibling;r&&"BR"===r.nodeName||l.insertNode(document.createElement("br"))}else{l=document.createRange();const e=t.lastChild;e&&"BR"!==e.nodeName&&"SPAN"!==e.nodeName&&t.appendChild(document.createElement("br")),t.appendChild(a),a.nextSibling&&"BR"===a.nextSibling.nodeName||t.appendChild(document.createElement("br"))}l.setStartAfter(a),l.collapse(!0),n.removeAllRanges(),n.addRange(l),t.focus()};h.addEventListener("keydown",(e=>{if("Backspace"!==e.key&&"Delete"!==e.key)return;const t=window.getSelection();if(!t.rangeCount||!h.contains(t.anchorNode))return;if(!t.getRangeAt(0).collapsed)return;const n=t.anchorNode,a=t.anchorOffset;if("Backspace"===e.key){if(n.nodeType===Node.TEXT_NODE&&0===a){const t=n.previousSibling;"SPAN"===t?.tagName&&"false"===t.contentEditable&&(t.remove(),e.preventDefault())}else if(n.nodeType===Node.ELEMENT_NODE){const t=a>0?n.childNodes[a-1]:n.previousSibling;"SPAN"===t?.tagName&&"false"===t.contentEditable&&(t.remove(),e.preventDefault())}}else if("Delete"===e.key)if(n.nodeType===Node.TEXT_NODE&&a===n.length){const t=n.nextSibling;"SPAN"===t?.tagName&&"false"===t.contentEditable&&(t.remove(),e.preventDefault())}else if(n.nodeType===Node.ELEMENT_NODE){const t=a<n.childNodes.length?n.childNodes[a]:n.nextSibling;"SPAN"===t?.tagName&&"false"===t.contentEditable&&(t.remove(),e.preventDefault())}"Delete"!==e.key||n!==h||0!==a||h.firstChild||e.preventDefault()})),r.addEventListener("change",(async()=>{const e=await Promise.all(Array.from(r.files).map(readFileAsync));for(const t of e)await A(t),m.push(t);r.value="",h.focus()})),h.addEventListener("input",(()=>{chatMessages[t.id]={html:h.innerHTML,files:m}})),chatMessages[t.id]=chatMessages[t.id]||{html:"",files:[]},h.innerHTML=chatMessages[t.id].html||"",m=chatMessages[t.id].files||[]},renderFlashcardChannel=(e,t)=>{e.innerHTML="";const n=createElement("div",{class:"flashcard-toolbar",style:{display:"flex",justifyContent:"space-between",alignItems:"center"}}),a=createElement("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center"}}),l=createElement("button",{type:"button",onclick:()=>A()},"Add Answer"),o=createElement("button",{type:"button",onclick:()=>u.requestSubmit()},"Add Flashcard"),r=createElement("button",{type:"button"},"Start Test");a.appendChild(l),a.appendChild(o),a.appendChild(r),n.appendChild(a);const i=createElement("div",{style:{display:"flex",flexWrap:"wrap",marginLeft:"auto"}}),s=createElement("button",{type:"button",onclick:()=>{const e=flashcards[t.id]||[],n=new Blob([JSON.stringify(e)],{type:"application/json"});createElement("a",{href:URL.createObjectURL(n),download:"flashcards.json"}).click()}},"Export");i.appendChild(s);const c=createElement("input",{type:"file",accept:"application/json",style:{display:"none"},onchange:async e=>{const n=e.target.files[0];if(!n)return;const a=await readFileAsync(n);try{const e=JSON.parse(a.content);Array.isArray(e)&&(flashcards[t.id]=flashcards[t.id]||[],e.forEach((e=>{const n=flashcards[t.id].findIndex((t=>t.question===e.question));-1!==n?flashcards[t.id][n]=e:flashcards[t.id].push(e)})),f())}catch{}}});c.addEventListener("click",(()=>{c.value=""})),i.appendChild(c),i.appendChild(createElement("button",{type:"button",onclick:()=>c.click()},"Import")),n.appendChild(i),e.appendChild(n);const d=createElement("div"),p=createElement("div"),u=createElement("form",{class:"flashcard-form",style:{display:"flex",flexWrap:"wrap",flexDirection:"column",marginRight:"10px"},onsubmit:e=>{e.preventDefault();const n=h.value.trim();if(!n)return;const a=Array.from(m.querySelectorAll(".answer-row")).map((e=>{const[t,n]=e.querySelectorAll("input");return n.value.trim()?{text:n.value,correct:t.checked}:null})).filter((e=>e));a.length&&(flashcards[t.id]=flashcards[t.id]||[],flashcards[t.id].push({question:n,answers:a}),h.value="",m.innerHTML="",A(),f())}}),h=createElement("input",{type:"text",placeholder:"Enter question here",required:!0});u.appendChild(h);const m=createElement("div",{id:"answers-container",style:{display:"flex",flexDirection:"column"}});u.appendChild(m);const A=(e="",t=!1)=>{const n=createElement("div",{class:"answer-row",style:{display:"flex",alignItems:"center"}});n.appendChild(createElement("input",{type:"checkbox",title:"Mark as correct answer",checked:t})),n.appendChild(createElement("input",{type:"text",placeholder:"Answer",required:!0,value:e,style:{flex:"1"}})),n.appendChild(createElement("button",{type:"button",class:"remove-btn",onclick:()=>n.remove()},"Remove")),m.appendChild(n)};A(),p.appendChild(u);const y=createElement("div");p.appendChild(y);const g=createElement("div",{style:{display:"none"}});d.appendChild(p),d.appendChild(g),e.appendChild(d);const f=()=>{y.innerHTML="",(flashcards[t.id]=flashcards[t.id]||[]).forEach(((e,n)=>{const a=createElement("div",{class:"flashcard"}),l=createElement("p",{},"Q: "+e.question);a.appendChild(l);const o=createElement("div");e.answers.forEach((e=>{const t=createElement("div",{class:e.correct?"correct-highlight":"",style:{display:"flex",alignItems:"center"}}),n=createElement("input",{type:"checkbox",checked:e.correct,disabled:!0});t.appendChild(n),t.appendChild(document.createTextNode(e.text)),o.appendChild(t)})),a.appendChild(o);const r=createElement("div",{class:"toolbar"}),i=createElement("button",{type:"button",onclick:function(){if("Edit"===this.textContent){const t=createElement("input",{type:"text",value:e.question,style:{width:"100%"}});a.replaceChild(t,l);const n=createElement("div");e.answers.forEach((e=>{const t=createElement("div",{class:"answer-row",style:{display:"flex",alignItems:"center"}});t.appendChild(createElement("input",{type:"checkbox",checked:e.correct})),t.appendChild(createElement("input",{type:"text",value:e.text,style:{flex:"1"}})),n.appendChild(t)})),a.replaceChild(n,o);const i=createElement("button",{type:"button",onclick:()=>{const e=createElement("div",{class:"answer-row",style:{display:"flex",alignItems:"center"}});e.appendChild(createElement("input",{type:"checkbox"})),e.appendChild(createElement("input",{type:"text",placeholder:"New answer",style:{flex:"1"}})),n.appendChild(e)}},"Add Answer");r.insertBefore(i,this.nextSibling),this.textContent="Save"}else{const t=a.querySelector("input[type='text']");e.question=t.value;const n=[];a.querySelectorAll(".answer-row").forEach((e=>{const[t,a]=e.querySelectorAll("input");a.value.trim()&&n.push({text:a.value,correct:t.checked})})),e.answers=n;const l=r.querySelector("button:nth-child(3)");l&&"Add Answer"===l.textContent&&r.removeChild(l),f()}}},"Edit");r.appendChild(i),r.appendChild(createElement("button",{type:"button",class:"remove-btn",onclick:()=>{flashcards[t.id].splice(n,1),f()}},"Remove")),a.appendChild(r),y.appendChild(a)})),r.disabled=!flashcards[t.id]?.length};f(),r.addEventListener("click",(()=>{p.style.display="none",v(g,t),g.style.display="block"}));const v=(e,t)=>{e.innerHTML="";const n=[...flashcards[t.id]||[]].sort((()=>Math.random()-.5));if(!n.length)return void(e.textContent="No flashcards available for testing.");const a=n.map((e=>{const t=e.answers.slice();for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return{question:e.question,answers:t}})),l=createElement("form",{onsubmit:e=>{e.preventDefault();let t=0;a.forEach(((e,n)=>{const a=Array.from(l.querySelectorAll(`input[name="card${n}"]:checked`)).map((e=>+e.value)),o=e.answers.map(((e,t)=>e.correct?t:null)).filter((e=>null!==e));a.sort().toString()===o.sort().toString()&&t++,l.querySelectorAll(`input[name="card${n}"]`).forEach((e=>{const t=+e.value;o.includes(t)?e.parentElement.classList.add("correct-highlight"):e.checked&&e.parentElement.classList.add("incorrect-highlight"),e.disabled=!0}))})),l.querySelector("button[type='submit']").disabled=!0,l.appendChild(createElement("div",{},`Your score: ${t} / ${a.length}`))}});a.forEach(((e,t)=>{const n=createElement("div");n.appendChild(createElement("p",{},"Q: "+e.question)),e.answers.forEach(((e,a)=>{const l=createElement("label",{style:{display:"flex",alignItems:"center"}});l.appendChild(createElement("input",{type:"checkbox",name:`card${t}`,value:a})),l.appendChild(document.createTextNode(e.text)),n.appendChild(l)})),l.appendChild(n)})),l.appendChild(createElement("button",{type:"submit"},"Submit Answers")),l.appendChild(createElement("button",{type:"button",onclick:()=>{e.style.display="none",p.style.display="block"}},"Back")),e.appendChild(l)}},renderWhiteboardChannel=(e,t)=>{e.innerHTML="",Object.assign(e.style,{display:"flex",flexDirection:"column"});const n=e=>JSON.parse(JSON.stringify(e)),a=30,l="#6e6e6e",o=(e,t)=>{if(e.length<=2)return e;const n=P/t,[a,l]=e[0],[r,i]=e[e.length-1],s=a===r&&l===i;if(s&&e.length<4)return e;let c=0,d=0;for(let t=1;t<e.length-1;t++){const[n,o]=e[t],s=Math.abs((i-l)*n-(r-a)*o+r*l-i*a)/Math.sqrt((i-l)**2+(r-a)**2);s>c&&(c=s,d=t)}if(c>n){const n=o(e.slice(0,d+1),t),a=o(e.slice(d),t);return n.slice(0,-1).concat(a)}return s?e:[e[0],e[e.length-1]]},r=(e,t)=>{let n=U*F%a,l=M*F%a;return n<0&&(n+=a),l<0&&(l+=a),{x:n+Math.round((e-n)/a)*a,y:l+Math.round((t-l)/a)*a}},i=(e,t,n,a)=>{for(let l=1;l<e.points.length;l++){const[o,r]=e.points[l-1],[i,s]=e.points[l],c=i-o,d=s-r,p=c*c+d*d;let u=0!==p?((t-o)*c+(n-r)*d)/p:-1;u=Math.max(0,Math.min(1,u));const h=o+u*c,m=r+u*d;if(Math.sqrt((t-h)**2+(n-m)**2)<=a+e.size/2)return!0}return!1},s="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAACJJREFUCJk9yrENACAMwDCH/38uA6KbpSRghj5o0XlDbYQL+jkIAvidO+wAAAAASUVORK5CYII=)",c="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAAB5JREFUCJk1xqEBAAAMAiDc/z+7JIlAC1nIwi3JLTzzKgYGsrMEWgAAAABJRU5ErkJggg==)",d="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAAB1JREFUCJljYGBgYPj/n4GBgYGJAQ4YISJwgKEAAMMDBgBop530AAAAAElFTkSuQmCC)",p="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAABpJREFUCJlj/P+fAQZgzP//meBiDEhMRoRaABfeB//R/QbHAAAAAElFTkSuQmCC)",u="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAACFJREFUCJk9yrEBACAMgLDg/z/XxcqUgZgBWnCoetz+UBfPuQYItwxrEQAAAABJRU5ErkJggg==)",h="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAACRJREFUCJk9yrEBACAMwzCFgzkmD8NC8aTBYR8gAxZN8zj9obm2PAYIElv9iAAAAABJRU5ErkJggg==)",m="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAACJJREFUCJk9yDEOACAMgMCr//8zLlUGQlBArd7YmGKmOD4X27YN+M4fMxgAAAAASUVORK5CYII=)",A="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAACZJREFUCJk9yLENACAQw8CDgTMMC4fmwYVlWQqkozcmVspZKdvnAlxFCpI9SNUzAAAAAElFTkSuQmCC)",y="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAABVJREFUCJlj+P+fgQGGEQDGwxSFYAC2jg/xSnNqwgAAAABJRU5ErkJggg==)",g="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAACRJREFUCJk9yrENADAMwzC66P8vu0ORcNKgtEDiZ8uxLrOs9gExQQoA46EVDwAAAABJRU5ErkJggg==)",f="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAACNJREFUCJlVyMEJADAMw8Bz9t/ZfQQK0UdIaSFhVjDs/5xsH8byCAIMFaqTAAAAAElFTkSuQmCC)",v="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAACJJREFUCJk9yLENADAMwzC6///sDEGjiVBaSLBsj7TPlX8ZiYkL+5+qckcAAAAASUVORK5CYII=)",b="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAABJJREFUCJlj+P+fgQGGEYCQKADtVxHvnhcbmgAAAABJRU5ErkJggg==)",C="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAACBJREFUCJlNyrEJAAAMwzD1/6PTKZDNCCMBroHqUDLDA1ErC/fu7xm7AAAAAElFTkSuQmCC)",E="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAACFJREFUCJljYGDI+8/AwMDAwMAIYzAwMMBEkYTy/iMpAADvsAiRbUJBSwAAAABJRU5ErkJggg==)",w="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAACFJREFUCJlVyrENACAMwDD3/6PDgIpEJg8BFFO2y3rkGw5hGwv3IhsceAAAAABJRU5ErkJggg==)",x="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAQAAAAnZu5uAAAAAXNSR0IArs4c6QAAACJJREFUCJljYGBgYGBgyPvPwMCY958BBiDMvP9wJgMDigIA+xgIkQzWf2UAAAAASUVORK5CYII=)",S=createElement("div",{class:"toolbar",style:{display:"flex",justifyContent:"space-between",alignItems:"center"}}),k=createElement("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center"}});let I,D,R,T,N,L,U,M,F,B,J,O="#fff",j=1,P=1,Q=0,W=0,G=0,q=0,z=!0,K=!1,Z=!1,V=!1,Y=!1,H=null,_=null,X=0,$=0,ee=null,te=!1,ne=null,ae=!1,le=null,oe=!1,re=[],ie=[];const se=e=>{re.push(e),re.length>10&&re.shift(),ie=[],ce()},ce=()=>{Te.disabled=0===re.length,Te.style.backgroundImage=Te.disabled?E:C,Ne.disabled=0===ie.length,Ne.style.backgroundImage=Ne.disabled?x:w},de=(e,t,n)=>(z=K=Z=V=!1,pe.style.backgroundColor=Ae.style.backgroundColor=ye.style.backgroundColor=Se.style.backgroundColor="",e=!e,t.style.backgroundColor=e?n:"",ke.disabled=!0,ke.style.backgroundImage=h,Ie.disabled=!0,Ie.style.backgroundImage=A,H=null,I.style.cursor="none",e),pe=createElement("button",{class:"button-icn",onclick:()=>{z=de(z,pe,"var(--color-accent)"),ze()},style:{backgroundImage:s,backgroundColor:"var(--color-accent)"},title:"Brush"}),ue=createElement("input",{type:"range",min:"0.3",max:"10",step:"0.1",value:"1",onchange:e=>{P=+e.target.value,ze()}}),he=createElement("input",{type:"color",value:"#ffffff",style:{colorScheme:"dark"},oninput:e=>{O=e.target.value,ze()}}),me=createElement("input",{type:"range",min:"1",max:"20",value:"1",onchange:e=>{j=+e.target.value,Ke()}}),Ae=createElement("button",{class:"button-icn",onclick:()=>{K=de(K,Ae,"#ff0000"),Ke()},style:{backgroundImage:c},title:"Eraser"}),ye=createElement("button",{class:"button-icn",onclick:()=>{Z=de(Z,ye,"var(--color-accent)"),ze()},style:{backgroundImage:d},title:"Pan"}),ge=e=>createElement("button",{class:"button-icn",onclick:()=>{zoomTargetScale=e?2*F:F/2,zoomTargetScale=Math.max(.1,Math.min(zoomTargetScale,10));const t=I.width/2,n=I.height/2;U+=t/zoomTargetScale-t/F,M+=n/zoomTargetScale-n/F,F=zoomTargetScale,R.panZoom={offsetX:U,offsetY:M,scale:F},We(),ze()},style:{backgroundImage:e?g:f},title:e?"Zoom In":"Zoom Out"}),fe=ge(!0),ve=ge(!1);let be=!0;const Ce=createElement("button",{class:"button-icn",onclick:()=>{be=!be,Ce.style.backgroundColor=be?"var(--color-accent)":"",R.areDotsVisible=be,We(),ze()},style:{backgroundImage:b},title:"Toggle Dots"});let Ee="#202124";const we=createElement("input",{type:"color",value:Ee,style:{colorScheme:"dark"},oninput:e=>{Ee=e.target.value,R.backgroundColor=Ee,ze()}}),xe=createElement("button",{class:"button-icn",onclick:()=>{Y=!Y,xe.style.backgroundColor=Y?"var(--color-accent)":""},style:{backgroundImage:p},title:"Snap"}),Se=createElement("button",{class:"button-icn",onclick:()=>{V=de(V,Se,"var(--color-accent)"),V?I.style.cursor="crosshair":(I.style.cursor="none",ke.disabled=!0,ke.style.backgroundImage=h,Ie.disabled=!0,Ie.style.backgroundImage=A,_=null,H=null,ze())},style:{backgroundImage:y},title:"Select"}),ke=createElement("button",{class:"button-icn",onclick:()=>_e(!1),disabled:!0,style:{backgroundImage:h},title:"Copy"}),Ie=createElement("button",{class:"button-icn",onclick:()=>_e(!0),disabled:!0,style:{backgroundImage:A},title:"Cut"}),De=createElement("input",{type:"file",accept:"image/*",style:{display:"none"},onchange:e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=()=>{const t=e.result,n=new Image;n.onload=()=>{const e=n.naturalWidth,a=n.naturalHeight,l=.25*(I.width/F),o=l*(a/e),r=Pe(I.width/2)-l/2,i=Qe(I.height/2)-o/2;N.push({dataUrl:t,x:r,y:i,width:l,height:o}),L.push(n),ze()},n.src=t},e.readAsDataURL(t)}De.value=""}}),Re=createElement("button",{class:"button-icn",onclick:()=>De.click(),style:{backgroundImage:v},title:"Attach"}),Te=createElement("button",{class:"button-icn",onclick:()=>{if(0===re.length)return;const e=re.pop();switch(ie.push(e),e.type){case"draw":case"erase":R.paths=e.prevState.paths,T=R.paths;break;case"copy":case"cut":case"paste":R.paths=e.prevState.paths,T=R.paths;break}ce(),ze()},disabled:!0,style:{backgroundImage:E},title:"Undo"}),Ne=createElement("button",{class:"button-icn",onclick:()=>{if(0===ie.length)return;const e=ie.pop();switch(re.push(e),e.type){case"draw":case"erase":R.paths=e.nextState.paths,T=R.paths;break;case"copy":case"cut":case"paste":R.paths=e.nextState.paths,T=R.paths;break}ce(),ze()},disabled:!0,style:{backgroundImage:x},title:"Redo"});k.append(pe,ue,he,Ae,me,ye,fe,ve,xe,Se,ke,Ie,Re,Ce,we,Te,Ne),S.appendChild(k);const Le=createElement("div",{style:{display:"flex",flexWrap:"wrap",marginLeft:"auto"}}),Ue=createElement("button",{type:"button",onclick:()=>{const e={paths:R.paths,images:R.images.map((e=>({dataUrl:e.dataUrl,x:e.x,y:e.y,width:e.width,height:e.height}))),panZoom:R.panZoom,areDotsVisible:R.areDotsVisible,backgroundColor:R.backgroundColor},t=new Blob([JSON.stringify(e)],{type:"application/json"});createElement("a",{href:URL.createObjectURL(t),download:"whiteboard.json"}).click()}},"Export");Le.appendChild(Ue);const Me=createElement("input",{type:"file",accept:"application/json",style:{display:"none"},onchange:e=>{const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=()=>{try{const e=JSON.parse(n.result);e.paths&&e.images&&e.panZoom&&(R.paths=e.paths,R.images=e.images,R.panZoom=e.panZoom,T=R.paths,N=R.images,({offsetX:U,offsetY:M,scale:F}=R.panZoom),L=[],e.images.forEach((e=>{const t=new Image;t.onload=()=>ze(),t.src=e.dataUrl,L.push(t)})),We(),ze())}catch(e){}},n.readAsText(t)}});Le.appendChild(Me),Le.appendChild(createElement("button",{type:"button",onclick:()=>Me.click()},"Import")),S.appendChild(Le),e.appendChild(S);const Fe=createElement("div",{style:{flex:"1",position:"relative",overflow:"hidden",touchAction:"none"}});I=createElement("canvas",{style:{cursor:"none"},class:"whiteboard-context"}),Fe.appendChild(I),e.appendChild(Fe),D=I.getContext("2d"),document.oncontextmenu=()=>!1,window.whiteboardData[t.id]=window.whiteboardData[t.id]||{paths:[],images:[],panZoom:{offsetX:0,offsetY:0,scale:1},areDotsVisible:!0,backgroundColor:"#202124"},R=window.whiteboardData[t.id],T=R.paths,N=R.images,L=[],({offsetX:U,offsetY:M,scale:F}=R.panZoom),be=R.areDotsVisible,Ee=R.backgroundColor,Ce.style.backgroundColor=be?"var(--color-accent)":"",we.value=Ee,N.forEach((e=>{const t=new Image;t.onload=()=>ze(),t.src=e.dataUrl,L.push(t)}));const Be=document.createElement("canvas"),Je=Be.getContext("2d"),Oe=e=>(e+U)*F,je=e=>(e+M)*F,Pe=e=>e/F-U,Qe=e=>e/F-M,We=(e=F)=>{Be.width=Fe.clientWidth||1,Be.height=Fe.clientHeight||1;let t=U*e%a,n=M*e%a;if(t<0&&(t+=a),n<0&&(n+=a),Je.fillStyle=l,Je.clearRect(0,0,Be.width,Be.height),be)for(let e=t;e<Be.width;e+=a)for(let t=n;t<Be.height;t+=a)Je.beginPath(),Je.arc(e,t,1,0,2*Math.PI),Je.fill()},Ge=e=>{D.beginPath();const t=e.points;if(t.length<2)return;const[n,a]=t[0];if(D.moveTo(Oe(n),je(a)),e.snapped)for(let e=1;e<t.length;e++){const[n,a]=t[e];D.lineTo(Oe(n),je(a))}else if(2===t.length){const[e,n]=t[1];D.lineTo(Oe(e),je(n))}else{for(let e=1;e<t.length-1;e++){const[n,a]=t[e-1],[l,o]=t[e],[r,i]=t[e+1],s=(l+r)/2,c=(o+i)/2;D.quadraticCurveTo(Oe(l),je(o),Oe(s),je(c))}const[e,n]=t[t.length-1];D.lineTo(Oe(e),je(n))}D.strokeStyle=e.color,D.lineWidth=e.size*F,D.lineCap="round",D.stroke()},qe=()=>{if(I.width=Fe.clientWidth,I.height=Fe.clientHeight,D.fillStyle=Ee,D.fillRect(0,0,I.width,I.height),D.drawImage(Be,0,0),N.forEach(((e,t)=>{const n=L[t];n&&n.complete&&D.drawImage(n,Oe(e.x),je(e.y),e.width*F,e.height*F)})),T.forEach(Ge),ee&&Ge(ee),Z){const e=I.width/2,t=I.height/2;D.save(),D.strokeStyle=l,D.lineWidth=1,D.beginPath(),D.moveTo(0,t),D.lineTo(I.width,t),D.moveTo(e,0),D.lineTo(e,I.height),D.stroke(),D.restore()}if(_){const e=Math.min(_.x0,_.x1),t=Math.max(_.x0,_.x1),n=Math.min(_.y0,_.y1),a=Math.max(_.y0,_.y1),l=Oe(t)-Oe(e),o=je(a)-je(n),r=Oe(e),i=je(n);((e,t,n,a,l,o,r,i,s)=>{e.save(),e.strokeStyle=r,e.lineWidth=i,e.setLineDash(s),e.beginPath(),e.moveTo(t+o,n),e.lineTo(t+a-o,n),e.quadraticCurveTo(t+a,n,t+a,n+o),e.lineTo(t+a,n+l-o),e.quadraticCurveTo(t+a,n+l,t+a-o,n+l),e.lineTo(t+o,n+l),e.quadraticCurveTo(t,n+l,t,n+l-o),e.lineTo(t,n+o),e.quadraticCurveTo(t,n,t+o,n),e.closePath(),e.stroke(),e.restore()})(D,r,i,l,o,6,"#6e6e6e",2,[10,5])}if(ne){const e=Oe(ne.x+ne.width),t=je(ne.y);D.save(),D.fillStyle="red",D.beginPath(),D.roundRect(e-10,t-10,20,20,5),D.fill(),D.strokeStyle="white",D.lineWidth=2,D.beginPath(),D.moveTo(e-5,t-5),D.lineTo(e+5,t+5),D.moveTo(e+5,t-5),D.lineTo(e-5,t+5),D.stroke(),D.restore()}},ze=((e,t)=>{let n,a;return function(...l){a?(clearTimeout(n),n=setTimeout((()=>{Date.now()-a>=t&&(e.apply(this,l),a=Date.now())}),t-(Date.now()-a))):(e.apply(this,l),a=Date.now())}})(qe,16),Ke=()=>{if(V&&H){let e=Pe(Q)-X/2,t=Qe(W)-$/2;if(Y){const n=r(Oe(e),je(t));e=Pe(n.x),t=Qe(n.y)}D.save(),D.globalAlpha=.5,H.forEach((n=>{D.beginPath();const[a,l]=n.points[0];D.moveTo(Oe(a+e),je(l+t));for(let a=1;a<n.points.length;a++){const[l,o]=n.points[a];D.lineTo(Oe(l+e),je(o+t))}D.strokeStyle=n.color,D.lineWidth=n.size*F,D.lineCap="round",D.stroke()})),D.restore()}else{const e=K?4*j:j;D.beginPath(),D.arc(Q,W,e/2+1,0,2*Math.PI),D.strokeStyle=K?"cyan":"black",D.lineWidth=1,D.stroke(),D.beginPath(),D.arc(Q,W,e/2,0,2*Math.PI),D.strokeStyle=K?"red":"white",D.lineWidth=1,D.stroke()}},Ze=(e,t)=>{const n=e.getBoundingClientRect();return{x:t.touches[0].clientX-n.left,y:t.touches[0].clientY-n.top}},Ve=(e,t)=>{const a=Pe(e),l=Qe(t);if(ne){const n=Oe(ne.x+ne.width),a=je(ne.y);if(Math.sqrt((e-n)**2+(t-a)**2)<10){const e=N.indexOf(ne);return-1!==e&&(N.splice(e,1),L.splice(e,1)),ne=null,void ze()}}const o=((e,t)=>{for(let n=N.length-1;n>=0;n--){const{x:a,y:l,width:o,height:r}=N[n];if(e>=a&&e<=a+o&&t>=l&&t<=l+r)return N[n]}return null})(a,l);if(o&&!z&&!K&&!Z&&!V)return ne=o,ae=!0,le=o,B=a-o.x,J=l-o.y,void ze();if(ne=null,te=!0,V&&H){let a=Pe(e)-X/2,l=Qe(t)-$/2;if(Y){const e=r(Oe(a),je(l));a=Pe(e.x),l=Qe(e.y)}const o={paths:n(T)};H.forEach((e=>T.push({points:e.points.map((([e,t])=>[e+a,t+l])),color:e.color,size:e.size,snapped:e.snapped})));const i={paths:n(T)};return se({type:"paste",prevState:o,nextState:i}),void ze()}if(z&&!K&&!Z&&!V){const e=Y?r(Oe(a),je(l)):{x:Oe(a),y:je(l)};ee={points:[[Pe(e.x),Qe(e.y)]],color:O,size:j/F,snapped:Y}}V&&!H&&(_={x0:a,y0:l,x1:a,y1:l}),Q=G=e,W=q=t},Ye=(e,t)=>{Q=e,W=t;const a=Pe(e),l=Qe(t);if(e<0||e>I.width||t<0||t>I.height){if(te&&ee&&z){const e={paths:n(T)};T.push(ee);const t={paths:n(T)};se({type:"draw",prevState:e,nextState:t}),ee=null,te=!1,ze()}oe=!0}else{if(ae)le.x=a-B,le.y=l-J;else if(te){if(Z)U+=(Q-G)/F,M+=(W-q)/F,R.panZoom={offsetX:U,offsetY:M,scale:F},We();else if(K){const e=2*j/F,t={paths:n(T)};let o=!1;for(let t=T.length-1;t>=0;t--)i(T[t],a,l,e)&&(T.splice(t,1),o=!0);if(o){const e={paths:n(T)};se({type:"erase",prevState:t,nextState:e})}}else if(V&&!H&&_)_.x1=a,_.y1=l;else if(ee&&z){const e=Y?r(Oe(a),je(l)):{x:Oe(a),y:je(l)};ee.points.push([Pe(e.x),Qe(e.y)]),ee.points.length>2&&(ee.points=o(ee.points,F))}G=Q,q=W}oe=!0}},He=()=>{if(ae)ae=!1,le=null;else if(te){if(ee&&ee.points.length>1){const e={paths:n(T)};T.push(ee);const t={paths:n(T)};se({type:"draw",prevState:e,nextState:t})}ee=null,te=!1,V&&_&&!H&&(ke.disabled=!1,ke.style.backgroundImage=u,Ie.disabled=!1,Ie.style.backgroundImage=m),ze()}},_e=e=>{if(!_)return;const t=Math.min(_.x0,_.x1),a=Math.max(_.x0,_.x1),l=Math.min(_.y0,_.y1),o=Math.max(_.y0,_.y1);X=a-t,$=o-l;const r=[],i=[];if(T.forEach(((n,s)=>{Xe(n,t,l,a,o)&&(r.push(n),e&&i.push(s))})),H=r.map((e=>({points:e.points.map((([e,n])=>[e-t,n-l])),color:e.color,size:e.size,snapped:e.snapped}))),e){const e={paths:n(T)};for(let e=i.length-1;e>=0;e--)T.splice(i[e],1);const t={paths:n(T)};se({type:"cut",prevState:e,nextState:t})}else se({type:"copy",prevState:{paths:JSON.parse(JSON.stringify(T))},nextState:{paths:JSON.parse(JSON.stringify(T))}});_=null,ke.disabled=!0,ke.style.backgroundImage=h,Ie.disabled=!0,Ie.style.backgroundImage=A,ze()},Xe=(e,t,n,a,l)=>{for(let o=1;o<e.points.length;o++){const[r,i]=e.points[o-1],[s,c]=e.points[o];if(r>=t&&r<=a&&i>=n&&i<=l||s>=t&&s<=a&&c>=n&&c<=l)return!0;if($e(r,i,s,c,t,n,a,l))return!0}return!1},$e=(e,t,n,a,l,o,r,i)=>et(e,t,n,a,l,o,l,i)||et(e,t,n,a,r,o,r,i)||et(e,t,n,a,l,o,r,o)||et(e,t,n,a,l,i,r,i),et=(e,t,n,a,l,o,r,i)=>{const s=(i-o)*(n-e)-(r-l)*(a-t);if(0===s)return!1;const c=((r-l)*(t-o)-(i-o)*(e-l))/s,d=((n-e)*(t-o)-(a-t)*(e-l))/s;return c>=0&&c<=1&&d>=0&&d<=1};I.addEventListener("mousedown",(e=>{0===e.button&&Ve(e.offsetX,e.offsetY)})),I.addEventListener("touchstart",(e=>{e.preventDefault();const t=Ze(I,e);Ve(t.x,t.y)}),{passive:!1}),I.addEventListener("mousemove",(e=>Ye(e.offsetX,e.offsetY))),I.addEventListener("touchmove",(e=>{const t=Ze(I,e);(te||Z||ae)&&e.preventDefault(),Ye(t.x,t.y)}),{passive:!1}),I.addEventListener("mouseup",He),I.addEventListener("touchend",(e=>{e.preventDefault(),He()}),{passive:!1}),I.addEventListener("mouseleave",(()=>{if(te&&He(),te&&ee&&z){const e={paths:n(T)};T.push(ee);const t={paths:n(T)};se({type:"draw",prevState:e,nextState:t}),ee=null,te=!1,ze()}})),I.addEventListener("touchcancel",(e=>{e.preventDefault(),He()}),{passive:!1});const tt=()=>{oe&&(qe(),oe=!1),Ke(),requestAnimationFrame(tt)};window.addEventListener("resize",(()=>{We(),ze()})),We(),ze(),ce(),requestAnimationFrame(tt)},renderCodeChannel=(container,channel)=>{container.innerHTML="",container.style.display="flex",container.style.flexDirection="column";const headerContainer=createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}}),buttonContainer=createElement("div",{style:{display:"flex",flexWrap:"wrap",marginLeft:"auto"}}),saveButton=createElement("button",{},"Save");buttonContainer.appendChild(saveButton),buttonContainer.appendChild(createElement("button",{onclick:()=>{const e=channelCategories.find((e=>"Functions"===e.name));if(!e?.channels?.length)return;const t=new Blob([JSON.stringify(e.channels)],{type:"application/json"});createElement("a",{href:URL.createObjectURL(t),download:"code_functions.json"}).click()}},"Export")),buttonContainer.appendChild(createElement("button",{onclick:()=>{const e=createElement("input",{type:"file",accept:"application/json",style:{display:"none"}});e.addEventListener("change",(async e=>{const t=e.target.files[0];if(!t)return;const n=await readFileAsync(t);try{const e=JSON.parse(n.content);if(Array.isArray(e)){let t=channelCategories.find((e=>"Functions"===e.name));t||(t={name:"Functions",channels:[]},channelCategories.push(t)),e.forEach((e=>{const n=t.channels.findIndex((t=>t.name.toLowerCase()===e.name.toLowerCase()));-1!==n?t.channels[n]=e:t.channels.push(e)})),renderSidebar()}}catch{}})),e.click()}},"Import")),headerContainer.appendChild(buttonContainer),container.appendChild(headerContainer);const ioContainer=createElement("div",{class:"toolbar",style:{display:"flex",alignItems:"center"}}),functionNameInput=createElement("input",{type:"text",placeholder:"Function Name..",style:{flex:"1",minWidth:"80px"}});ioContainer.appendChild(functionNameInput),container.appendChild(ioContainer);const wrapper=createElement("div",{class:"code-runner-wrapper",style:{flex:"1",position:"relative",display:"grid",gridTemplateRows:"1fr 100px",overflow:"hidden"}});container.appendChild(wrapper);const runButton=createElement("button",{class:"run-btn"},"Run Code");wrapper.appendChild(runButton);const codeTextarea=createElement("textarea",{spellcheck:"false",class:"code-runner-textarea"});wrapper.appendChild(codeTextarea),window.codeData[channel.id]&&(codeTextarea.value=window.codeData[channel.id]),codeTextarea.addEventListener("input",(()=>{window.codeData[channel.id]=codeTextarea.value}));const outputDiv=createElement("div",{class:"code-runner-output"});wrapper.appendChild(outputDiv),runButton.addEventListener("click",(()=>{const code=codeTextarea.value,logs=[],originalLog=console.log;console.log=(...e)=>{logs.push(e.join(" ")),originalLog(...e)};try{const result=eval(code);outputDiv.textContent=logs.length?logs.join("\n"):void 0!==result?result:"Code executed successfully."}catch(e){outputDiv.textContent="Error: "+e}console.log=originalLog})),functionNameInput.addEventListener("input",(()=>{const e=channelCategories.find((e=>"Functions"===e.name));saveButton.textContent=e&&e.channels.find((e=>e.name.toLowerCase()===functionNameInput.value.trim().toLowerCase()))?"Update":"Save"})),saveButton.addEventListener("click",(()=>{const e=codeTextarea.value;if(!e.trim())return;let t=channelCategories.find((e=>"Functions"===e.name));t||(t={name:"Functions",channels:[]},channelCategories.push(t));let n=functionNameInput.value.trim()||"Saved Function "+(t.channels.length+1);const a=t.channels.findIndex((e=>e.name.toLowerCase()===n.toLowerCase()));if(-1!==a)t.channels[a].code=e;else{const a="func_"+Date.now()+"_"+Math.random().toString(36).substring(2,9);t.channels.push({id:a,name:n,type:"function",code:e})}renderSidebar(),functionNameInput.value="",saveButton.textContent="Save"}))},renderCryptChannel=(e,t)=>{e.innerHTML="";const n=createElement("div",{class:"crypt-container",style:{display:"flex",flexDirection:"column"}}),a=createElement("div",{class:"iosec",style:{display:"flex",justifyContent:"space-between",flexWrap:"wrap"}});let l=!1,o="",r="";const i=()=>{const e=c.value||l,t=L.value,n=g.value&&!g._binaryData,a=l&&g._binaryData;R.disabled=!e||!t,T.disabled=!e||!t,d.disabled=!c.value,U.disabled=!t,b.disabled=!a,v.disabled=!n},s=createElement("div",{style:{flex:"1",marginRight:"5px"}}),c=createElement("textarea",{placeholder:"Enter your message here",rows:"10",class:"crypt-textarea"}),d=createElement("button",{onclick:()=>{navigator.clipboard.writeText(c.value)},disabled:!0},"Copy Message"),p=createElement("button",{onclick:()=>{m.click()}},"Attach File"),u=createElement("button",{onclick:()=>{l=!1,o="",r="",c.disabled=!1,g.disabled=!0,c.value="",g.value="",c.placeholder="Enter your message here",g.placeholder="The result will appear here",u.style.display="none",p.style.display="inline",h.textContent="",i()},style:{display:"none"}},"Clear File"),h=createElement("div",{style:{marginTop:"5px",fontSize:"12px",color:"#666"}}),m=createElement("input",{type:"file",style:{display:"none"}});m.addEventListener("click",(()=>{m.value=""})),m.addEventListener("change",(function(){if(m.files&&m.files[0]){const e=m.files[0];o=e.name,r=e.type||"application/octet-stream",l=!0,c.disabled=!0,g.disabled=!0,c.placeholder="File content loaded (binary data)",g.placeholder="Encrypted/Decrypted file content will appear here",u.style.display="inline",p.style.display="none",h.textContent=`File: ${o} (${M(e.size)})`;const t=new FileReader;t.onload=e=>{const t=e.target.result,n=new Uint8Array(t);c.value="_BINARY_DATA_",c._binaryData=n,i()},t.readAsArrayBuffer(e)}})),s.appendChild(c);const A=createElement("div",{style:{display:"flex",justifyContent:"space-between"}});A.appendChild(p),A.appendChild(u),A.appendChild(d),s.appendChild(A),s.appendChild(h),s.appendChild(m),a.appendChild(s);const y=createElement("div",{style:{flex:"1",marginLeft:"5px"}}),g=createElement("textarea",{placeholder:"The result will appear here",disabled:!0,rows:"10",class:"crypt-textarea"}),f=createElement("div",{style:{marginTop:"5px",fontSize:"12px",color:"#666"}}),v=createElement("button",{onclick:()=>{navigator.clipboard.writeText(g.value)},disabled:!0},"Copy Result"),b=createElement("button",{onclick:()=>{if(l&&g._binaryData){let e=o;if(e.includes(".")){const t=e.split(".");t.pop();const n=t.join(".");e=e.endsWith(".enc")?n:`${e}.enc`}else e=`${e}.enc`;const t=new Blob([g._binaryData],{type:r}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}else{const e=new Blob([g.value],{type:"text/plain"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="result.txt",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}},disabled:!0},"Download");y.appendChild(g);const C=createElement("div",{style:{display:"flex",justifyContent:"space-between"}});C.appendChild(b),C.appendChild(v),y.appendChild(C),y.appendChild(f),a.appendChild(y),n.appendChild(a);const E=createElement("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap"}}),w=createElement("label",{style:{margin:"var(--margin-small)"}},"Password Length: "),x=createElement("input",{type:"range",min:"16",max:"200",value:"24",oninput:e=>{S.textContent=e.target.value}}),S=createElement("span",{},x.value);w.appendChild(x),w.appendChild(S),E.appendChild(w);const k=createElement("button",{onclick:()=>{const e=parseInt(x.value,10);L.value=F(e),i()}},"Generate"),I=createElement("input",{type:"file",style:{display:"none"}}),D=createElement("button",{onclick:()=>I.click()},"Attach");I.addEventListener("change",(async()=>{const e=I.files[0];if(e){const t=await readFileAsync(e);L.value=t.content.trim(),i(),I.value=""}}));const R=createElement("button",{disabled:!0},"Encrypt"),T=createElement("button",{disabled:!0},"Decrypt");E.appendChild(k),E.appendChild(D),E.appendChild(I),E.appendChild(R),E.appendChild(T),n.appendChild(E);const N=createElement("div",{style:{display:"flex",alignItems:"center"}}),L=createElement("input",{type:"text",placeholder:"Enter encryption key",class:"crypt-textarea",style:{flex:"1"}}),U=createElement("button",{onclick:()=>{navigator.clipboard.writeText(L.value)},disabled:!0},"Copy Key");N.appendChild(L),N.appendChild(U),n.appendChild(N),e.appendChild(n);const M=e=>e<1024?e+" bytes":e<1048576?(e/1024).toFixed(2)+" KB":(e/1048576).toFixed(2)+" MB",F=e=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõöøùúûüýþÿ¡¢£¤¥¦§¨©«®¯°±²³´µ¶·¸¹º¼½¾¿€©®™×÷ƒ∑∆∂∞≈≠≡≤≥⊂⊃∈∉√π∞∩∪⊥∧∨∩≈⊕⊗∫";let n="";for(let a=0;a<e;a++)n+=t.charAt(Math.floor(Math.random()*t.length));return n};c.addEventListener("input",i),L.addEventListener("input",i),m.addEventListener("change",i),g.addEventListener("input",i),R.onclick=async()=>{if(L.value.length>=16)try{if(l&&c._binaryData){const e=c._binaryData,[t,n,a]=await(async(e,t)=>{const n=crypto.getRandomValues(new Uint8Array(16)),a=crypto.getRandomValues(new Uint8Array(12)),l=await deriveKey(t,n),o=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},l,e);return[new Uint8Array(o),a,n]})(e,L.value);g._binaryData=(e=>{const t=e.reduce(((e,t)=>e+t.length),0),n=new Uint8Array(t);let a=0;return e.forEach((e=>{n.set(e,a),a+=e.length})),n})([a,n,t]),g.value="_ENCRYPTED_BINARY_DATA_",g.disabled=!0,f.textContent=`Encrypted: ${M(g._binaryData.length)} (ready to download)`}else{g._binaryData=null;const{encryptedText:e,iv:t,salt:n}=await encryptText(c.value,L.value);g.value=e,g.iv=t,g.salt=n,g.disabled=!0,f.textContent=""}i()}catch(e){f.textContent=`Encryption failed: ${e.message}`}else f.textContent="Please enter an encryption key of minimum 16 characters."},T.onclick=async()=>{if(L.value.length>=16)try{if(l&&c._binaryData){const e=c._binaryData,t=e.slice(0,16),n=e.slice(16,28),a=e.slice(28),l=await(async(e,t,n,a)=>{const l=await deriveKey(t,a),o=await crypto.subtle.decrypt({name:"AES-GCM",iv:n},l,e);return new Uint8Array(o)})(a,L.value,n,t);g._binaryData=l,g.value="_DECRYPTED_BINARY_DATA_",g.disabled=!0,f.textContent=`Decrypted: ${M(l.length)} (ready to download)`,i()}else try{const e=await decryptText(c.value,L.value);g.value=e,f.textContent="",i()}catch(e){f.textContent=`Decryption failed: ${e.message}`}}catch(e){f.textContent=`Decryption failed: ${e.message}. Make sure the input is valid and the encryption key is correct.`}else f.textContent="Please enter an encryption key (minimum 16 characters)."},i()},renderReminderChannel=(e,t)=>{e.innerHTML="";const n=e=>{const{r:t,g:n,b:a}=(e=>{if((e=e.trim().toLowerCase()).startsWith("#")){let t=e.slice(1);return[3,4].includes(t.length)&&(t=t.split("").map((e=>e+e)).join("")),{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16)}}if(e.startsWith("rgb")){const t=e.match(/(\d+)/g)||[];return{r:+t[0]||0,g:+t[1]||0,b:+t[2]||0}}return{r:255,g:255,b:255}})(e),l=e=>(e/=255)<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4);return.2126*l(t)+.7152*l(n)+.0722*l(a)>.179?"#000000":"#ffffff"};reminders[t.id]=reminders[t.id]||[];const a=createElement("div"),l=createElement("form",{onsubmit:e=>{e.preventDefault(),reminders[t.id].push({date:o.value||null,text:r.value,color:i.value}),o.value="",r.value="",s()},style:{display:"flex",flexWrap:"wrap",alignItems:"center"}}),o=createElement("input",{type:"datetime-local",style:{colorScheme:"dark"}}),r=createElement("input",{type:"text",placeholder:"Reminder text",required:!0}),i=createElement("input",{type:"color",value:"#007bff",style:{colorScheme:"dark"}});l.append(o,r,i,createElement("button",{type:"submit"},"Add Reminder")),e.appendChild(l),e.appendChild(a);const s=()=>{a.innerHTML="",reminders[t.id].forEach(((e,l)=>{const o=createElement("div",{class:"reminder-container",style:{backgroundColor:e.color,color:n(e.color),borderRadius:"var(--border-radius-small)",position:"relative",padding:"var(--padding-small)",margin:"var(--margin-small)"}});e.date&&o.appendChild(createElement("div",{},new Date(e.date).toLocaleString())),o.appendChild(createElement("div",{},e.text)),o.appendChild(createElement("button",{class:"remove-btn",style:{position:"absolute",top:"0",right:"0",padding:"2px 8px",border:"none",background:"transparent",color:"inherit",cursor:"pointer",fontSize:"14px",borderRadius:"0 4px 0 4px"},onclick:()=>{reminders[t.id].splice(l,1),s()}},"×")),a.appendChild(o)}))};s()};let autoSaveIntervalId=null,isAutoSaveEnabled="true"===localStorage.getItem("autoSaveEnabled"),autoSaveInterval=parseInt(localStorage.getItem("autoSaveInterval"),10)||3e4,lastSaveTimestamp=Date.now(),countdownIntervalId=null,encryptionToken="";async function deriveKey(e,t){const n=new TextEncoder,a=await crypto.subtle.importKey("raw",n.encode(e),"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e4,hash:"SHA-256"},a,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}const arrayToHex=e=>Array.from(e).map((e=>("0"+e.toString(16)).slice(-2))).join(""),hexToArray=e=>{const t=e.length/2,n=new Uint8Array(t);for(let a=0;a<t;a++)n[a]=parseInt(e.substring(2*a,2*a+2),16);return n},encryptText=async(e,t)=>{const n=crypto.getRandomValues(new Uint8Array(16)),a=crypto.getRandomValues(new Uint8Array(12)),l=(new TextEncoder).encode(e),o=await deriveKey(t,n),r=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},o,l);return{encryptedText:arrayToHex(n)+":"+arrayToHex(a)+":"+arrayToHex(new Uint8Array(r)),iv:arrayToHex(a),salt:arrayToHex(n)}},decryptText=async(e,t)=>{const[n,a,l]=e.split(":");if(!n||!a||!l)throw new Error("Invalid encrypted message format");const o=hexToArray(n),r=hexToArray(a),i=hexToArray(l),s=await deriveKey(t,o),c=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},s,i);return(new TextDecoder).decode(c)},saveData=async()=>{const e={chatMessages:chatMessages,flashcards:flashcards,codeData:window.codeData,reminders:reminders,categories:channelCategories},t=window.whiteboardData;if(encryptionToken)try{const n=JSON.stringify(e),a=await encryptText(n,encryptionToken);localStorage.setItem("appData",JSON.stringify({encrypted:!0,data:a,whiteboardData:t})),localStorage.setItem("isEncrypted","true")}catch(n){alert("Failed to encrypt data. Saving unencrypted."),localStorage.setItem("appData",JSON.stringify({encrypted:!1,data:e,whiteboardData:t})),localStorage.setItem("isEncrypted","false")}else localStorage.setItem("appData",JSON.stringify({encrypted:!1,data:e,whiteboardData:t})),localStorage.setItem("isEncrypted","false");lastSaveTimestamp=Date.now()},startAutoSave=()=>{stopAutoSave(),autoSaveIntervalId=setInterval(saveData,autoSaveInterval)},stopAutoSave=()=>{autoSaveIntervalId&&(clearInterval(autoSaveIntervalId),autoSaveIntervalId=null)},startCountdownDisplay=e=>{stopCountdownDisplay(),updateCountdownDisplay(e),countdownIntervalId=setInterval((()=>updateCountdownDisplay(e)),100)},stopCountdownDisplay=()=>{countdownIntervalId&&(clearInterval(countdownIntervalId),countdownIntervalId=null)},updateCountdownDisplay=e=>{if(isAutoSaveEnabled){const t=Date.now()-lastSaveTimestamp,n=Math.max(0,autoSaveInterval-t);e.textContent=`Auto-save in: ${(n/1e3).toFixed(1)}s`}else e.textContent="Auto-save in: --s"},renderFilesChannel=(e,t)=>{e.innerHTML="";let n=null,a=!1,l=null,o=null,r="";const i=createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"}}),s=createElement("div",{style:{width:"100%",display:"flex",alignItems:"center"}}),c=createElement("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center"}}),d=createElement("span",{style:{fontSize:"12px",color:"#666",margin:"var(--margin-small)",display:"block"}},"Supported: JPG, PNG, WebP, PDF");e.append(i,d,s);const p=createElement("input",{type:"file",accept:".jpg,.jpeg,.png,.webp,.pdf",style:{display:"none"},onchange:function(e){n=e.target.files[0],a=!1,A.disabled=!n,y.disabled=!0,f.disabled=!0,l=null,o=null,r="",g.value="",p.value="",function(){if(m.innerHTML="",!n)return m.innerHTML='<option value="">Select a file to choose conversion</option>',m.disabled=!0,void v();m.disabled=!1;const e="."+n.name.split(".").pop().toLowerCase();let t=!1;for(const[n,a]of Object.entries(h))if(a.formats.includes(e)){const e=createElement("option",{value:n},a.label);m.appendChild(e),t=!0}t||(m.innerHTML='<option value="">No conversions available</option>',m.disabled=!0);v()}()}}),u=createElement("button",{onclick:()=>p.click()},"Import File"),h={base64:{label:"Convert to Base64",formats:".jpg,.jpeg,.png,.webp",supports:"JPG, PNG, WebP"},pdfToImages:{label:"Convert PDF to Images",formats:".pdf",supports:"PDF"}},m=createElement("select",{style:{margin:"var(--margin-small)"},onchange:()=>{v(),n&&(a=!1,A.disabled=!1)}});m.innerHTML='<option value="">Import a file to convert</option>',m.disabled=!0;const A=createElement("button",{disabled:!0,onclick:async function(){if(!n)return void alert("Please select a file.");const e=m.value;if(!e)return void alert("Please select a valid conversion option.");l=null,o=null,r="",g.value="",y.disabled=!0,f.disabled=!0;try{switch(e){case"base64":await async function(){const e=await b(n);l="text",o=e.content,r=`${n.name.split(".").slice(0,-1).join(".")||"input"}_base64.txt`,g.value=o,y.disabled=!1,f.disabled=!1}();break;case"pdfToImages":await async function(){const e=await async function(e){if(!window.pdfjsLib||!window.JSZip)throw new Error("Required libraries (pdf.js or JSZip) are not loaded.");const t=window.pdfjsLib,n=window.JSZip,a=await e.arrayBuffer(),l=await t.getDocument({data:a}).promise,o=new n;for(let e=1;e<=l.numPages;e++){const t=await l.getPage(e),n=t.getViewport({scale:2}),a=document.createElement("canvas"),r=a.getContext("2d");a.width=n.width,a.height=n.height;const i={canvasContext:r,viewport:n};await t.render(i).promise;const s=await new Promise((e=>a.toBlob(e,"image/jpeg"))),c=await s.arrayBuffer();o.file(`Page_${e}.jpg`,c)}return await o.generateAsync({type:"blob"})}(n);l="blob",o=e,r=`${n.name.split(".").slice(0,-1).join(".")||"input"}_pages.zip`,g.value="ZIP file ready for download",y.disabled=!1,f.disabled=!0}();break;default:alert("Unknown conversion option.")}a=!0,A.disabled=!0}catch(e){alert(`Conversion failed: ${e.message}`)}}},"Convert"),y=createElement("button",{disabled:!0,onclick:()=>{if("text"===l)C("data:text/plain;charset=utf-8,"+encodeURIComponent(o),r);else if("blob"===l){const e=URL.createObjectURL(o);C(e,r),URL.revokeObjectURL(e)}}},"Download"),g=createElement("input",{type:"text",placeholder:"Converted output will appear here...",readonly:!0,style:{flexGrow:1,marginRight:"5px"}}),f=createElement("button",{disabled:!0,onclick:()=>{g.value&&(navigator.clipboard.writeText(g.value),alert("Copied to clipboard!"))}},"Copy");function v(){const e=h[m.value];d.textContent=e?`Supported: ${e.supports}`:"Supported: JPG, PNG, WebP, PDF"}const b=e=>new Promise(((t,n)=>{const a=new FileReader;a.onload=()=>t({content:a.result}),a.onerror=n,a.readAsDataURL(e)})),C=(e,t)=>{const n=createElement("a",{href:e,download:t});document.body.appendChild(n),n.click(),document.body.removeChild(n)};c.append(p,u,m,A,y),i.append(c),s.append(g,f)},renderSettingsChannel=(e,t)=>{e.innerHTML="";const n=createElement("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"flex-end"}}),a=createElement("button",{class:"inv-btn",onclick:()=>{if(a.disabled)return;a.disabled=!0,saveData();const e=a.textContent;a.textContent="Saving...",b(),setTimeout((()=>{a.textContent=e,a.disabled=!1}),500)}},"Save data"),l=createElement("button",{class:"remove-btn"},"Erase memory");(()=>{let e=!1;const t=t=>{t.preventDefault(),e?((()=>{localStorage.removeItem("appData"),localStorage.removeItem("autoSaveEnabled"),localStorage.removeItem("autoSaveInterval"),localStorage.removeItem("isEncrypted"),Object.keys(chatMessages).forEach((e=>delete chatMessages[e])),Object.keys(flashcards).forEach((e=>delete flashcards[e])),Object.keys(reminders).forEach((e=>delete reminders[e])),window.whiteboardData={},window.codeData={};const e=channelCategories.findIndex((e=>"Functions"===e.name));-1!==e&&channelCategories.splice(e,1),renderSidebar(),isAutoSaveEnabled=!1,u.checked=!1,autoSaveInterval=3e4,m.value=autoSaveInterval,A.textContent=`Interval: ${autoSaveInterval/1e3}s`,stopAutoSave(),stopCountdownDisplay(),v.textContent="Auto-save in: --s",alert("Memory erased."),b()})(),l.textContent="Erase memory",l.classList.remove("confirm-btn"),e=!1):(l.textContent="Are you sure?",l.classList.add("confirm-btn"),e=!0,l.disabled=!0,setTimeout((()=>{l.disabled=!1}),1e3))};l.removeEventListener("click",t),l.addEventListener("click",t);const n=t=>{t.target!==l&&e&&!l.disabled&&(l.textContent="Erase memory",l.classList.remove("confirm-btn"),e=!1)};document.removeEventListener("click",n),document.addEventListener("click",n)})(),n.appendChild(a),n.appendChild(l),e.appendChild(n);const o=createElement("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap"}}),r=createElement("label",{style:{margin:"var(--margin-small)"}},"Token (Encryption Key): "),i=createElement("input",{type:"text",placeholder:"Enter token for encrypted save",value:encryptionToken,oninput:e=>{encryptionToken=e.target.value},style:{flex:"1",minWidth:"150px",marginRight:"var(--margin-small)"}}),s=createElement("button",{onclick:()=>{c.click()},style:{marginRight:"var(--margin-small)"}},"Attach"),c=createElement("input",{type:"file",style:{display:"none"}});c.addEventListener("change",(async()=>{const e=c.files[0];if(e){const t=await readFileAsync(e);i.value=t.content.trim(),encryptionToken=i.value,c.value=""}})),o.appendChild(r),o.appendChild(i),o.appendChild(s),o.appendChild(c),e.appendChild(o);const d=createElement("div",{style:{display:"flex",alignItems:"center",margin:"var(--margin-small)"}}),p=createElement("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center"}});e.appendChild(d),d.appendChild(p);const u=createElement("input",{type:"checkbox",checked:isAutoSaveEnabled,onchange:e=>{isAutoSaveEnabled=e.target.checked,localStorage.setItem("autoSaveEnabled",isAutoSaveEnabled),isAutoSaveEnabled?(saveData(),startAutoSave(),startCountdownDisplay(v)):(stopAutoSave(),stopCountdownDisplay(),v.textContent="Auto-save in: --s")}}),h=createElement("label",{style:{display:"flex",alignItems:"center"}},"Auto Save: ",u),m=createElement("input",{style:{margin:"var(--margin-small)"},type:"range",min:"1000",max:"60000",step:"1000",value:autoSaveInterval,oninput:e=>{autoSaveInterval=parseInt(e.target.value,10),localStorage.setItem("autoSaveInterval",autoSaveInterval),A.textContent=`Interval: ${autoSaveInterval/1e3}s`,isAutoSaveEnabled&&(lastSaveTimestamp=Date.now(),startAutoSave(),startCountdownDisplay(v))}}),A=createElement("span",{style:{}},`Interval: ${autoSaveInterval/1e3}s`),y=createElement("div",{style:{display:"flex",alignItems:"center"}},m,A);p.appendChild(h),p.appendChild(y);const g=createElement("div",{style:{margin:"var(--margin-small)",color:"var(--color-text-muted)"}}),f=createElement("div"),v=createElement("div",{style:{margin:"var(--margin-small)",color:"var(--color-text-muted)"}},"Auto-save in: --s"),b=()=>{const e={chatMessages:chatMessages,flashcards:flashcards,whiteboardData:window.whiteboardData,codeData:window.codeData,reminders:reminders},t=JSON.stringify(e),n=new Blob([t]).size,a=5242880,l=n/a*100;f.style.width=l+"%",g.textContent=`Memory used: ${(n/1048576).toFixed(2)} MB (${l.toFixed(1)}% of ${5..toFixed(2)} MB)`};g.appendChild(f),e.appendChild(g),e.appendChild(v),isAutoSaveEnabled&&startCountdownDisplay(v),b()},loadSavedData=async()=>{const e=localStorage.getItem("appData"),t="true"===localStorage.getItem("isEncrypted");if(e)try{const n=JSON.parse(e);if(window.whiteboardData=n.whiteboardData||{},t)return void await showDecryptModal();{const e=n.data;Object.assign(chatMessages,e.chatMessages||{}),Object.assign(flashcards,e.flashcards||{}),window.codeData=e.codeData||{},Object.assign(reminders,e.reminders||{}),e.categories&&channelCategories.splice(0,channelCategories.length,...e.categories)}}catch(e){}isAutoSaveEnabled&&startAutoSave(),renderSidebar(),channelCategories.length&&channelCategories[0].channels.length&&selectChannel(channelCategories[0].channels[0])},showDecryptModal=async()=>{const e=localStorage.getItem("appData"),t="true"===localStorage.getItem("isEncrypted");if(!e||!t)return;const n=createElement("div",{style:{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"1000"}}),a=createElement("div",{style:{backgroundColor:"var(--color-primary)",padding:"var(--padding-small)",borderRadius:"var(--border-radius-small)",display:"flex",flexDirection:"column",alignItems:"center",width:"90%",maxWidth:"400px",color:"var(--color-text-light)"}}),l=createElement("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"var(--margin-small)",width:"100%"}}),o=createElement("input",{type:"text",placeholder:"Enter encryption token"}),r=createElement("input",{type:"file",style:{display:"none"}}),i=createElement("button",{onclick:()=>r.click()},"Attach");r.addEventListener("change",(async()=>{const e=r.files[0];if(e){const t=await readFileAsync(e);o.value=t.content.trim(),s.disabled=!o.value.trim(),c.style.display="none",r.value=""}}));const s=createElement("button",{onclick:async()=>{const t=o.value.trim();if(!t)return c.style.display="block",void(c.textContent="Please enter a token.");try{const a=JSON.parse(e),l=await decryptText(a.data.encryptedText,t),o=JSON.parse(l);Object.assign(chatMessages,o.chatMessages||{}),Object.assign(flashcards,o.flashcards||{}),window.codeData=o.codeData||{},Object.assign(reminders,o.reminders||{}),o.categories&&channelCategories.splice(0,channelCategories.length,...o.categories),window.whiteboardData=a.whiteboardData||{},document.body.removeChild(n),renderSidebar(),channelCategories.length&&channelCategories[0].channels.length&&selectChannel(channelCategories[0].channels[0])}catch(e){c.style.display="block",c.textContent="Incorrect token. Please try again."}},disabled:!0},"Load Data");l.appendChild(o),l.appendChild(i),l.appendChild(r),l.appendChild(s);const c=createElement("div",{style:{color:"var(--color-text-muted)",fontSize:"var(--font-size-small)",margin:"var(--margin-small)",display:"none",textAlign:"center"}},"Incorrect token. Please try again."),d=createElement("button",{class:"button-aux",onclick:()=>{document.body.removeChild(n),renderSidebar(),channelCategories.length&&channelCategories[0].channels.length&&selectChannel(channelCategories[0].channels[0])}},"Skip");o.addEventListener("input",(()=>{s.disabled=!o.value.trim(),c.style.display="none"})),a.appendChild(l),a.appendChild(c),a.appendChild(d),n.appendChild(a),document.body.appendChild(n),o.focus()};document.addEventListener("DOMContentLoaded",(()=>{loadSavedData()}))})();