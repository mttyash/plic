(()=>{const createElement=(e,t={},...n)=>{const a=document.createElement(e);for(let[e,n]of Object.entries(t))"class"===e?a.className=n:"style"===e?Object.assign(a.style,n):e.startsWith("on")&&"function"==typeof n?a.addEventListener(e.slice(2).toLowerCase(),n):a[e]=n;return n.forEach((e=>{"string"==typeof e?a.appendChild(document.createTextNode(e)):e&&a.appendChild(e)})),a},channelCategories=[{name:"General",channels:[{id:"text1",name:"General Chat",type:"text"}]},{name:"Learning",channels:[{id:"flashcard1",name:"Flashcards",type:"flashcard"},{id:"whiteboard1",name:"Whiteboard",type:"whiteboard"}]},{name:"Reminders",channels:[{id:"reminder1",name:"Reminders",type:"reminder"}]},{name:"Utilities",channels:[{id:"code1",name:"Code Runner",type:"code"},{id:"crypt1",name:"Crypt",type:"crypt"}]},{name:"Settings",channels:[{id:"settings",name:"Settings",type:"settings"}]}],chatMessages={},flashcards={},reminders={};window.whiteboardData=window.whiteboardData||{},window.codeData=window.codeData||{};const readFileAsync=e=>new Promise((t=>{const n=new FileReader;n.onload=n=>t({name:e.name,type:e.type,content:n.target.result}),e.type.startsWith("image/")||e.type.startsWith("audio/")?n.readAsDataURL(e):n.readAsText(e)})),renderSidebar=()=>{const e=document.querySelector(".topbar");e.innerHTML="",channelCategories.forEach((t=>{const n=createElement("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"}}),a=createElement("div",{class:"channel-list"});t.channels.forEach((e=>{const t=createElement("div",{class:"channel-item","data-channel-id":e.id,"data-channel-type":e.type,oncontextmenu:n=>{if(n.preventDefault(),"function"===e.type){t.textContent="Remove",t.classList.add("remove-btn"),t.title="Click to remove";const n=a=>{a.stopPropagation();const l=channelCategories.find((e=>"Functions"===e.name));l&&(l.channels=l.channels.filter((t=>t.id!==e.id)),renderSidebar()),t.removeEventListener("click",n)},a=l=>{l.target!==t&&(t.classList.remove("remove-btn"),t.title="",t.textContent=e.name,t.removeEventListener("click",n),document.removeEventListener("click",a))};t.addEventListener("click",n),document.addEventListener("click",a)}},onclick:()=>{if("function"===e.type){const t=channelCategories.flatMap((e=>e.channels)).find((e=>"code"===e.type));t&&(window.codeData[t.id]=e.code,selectChannel(t))}else selectChannel(e)}},e.name);a.appendChild(t)})),n.appendChild(a),e.appendChild(n)})),e.appendChild(createElement("div",{class:"version-text",style:{marginLeft:"auto",padding:"0 1rem"}},"v1.30"))};let activeChannelId=null;const selectChannel=e=>{activeChannelId=e.id,document.querySelectorAll(".channel-item").forEach((t=>{t.classList.toggle("active-channel",t.getAttribute("data-channel-id")===e.id)})),renderChannel(e)},renderChannel=e=>{const t=document.querySelector(".main-content");t.innerHTML="";({text:()=>renderTextChannel(t,e),flashcard:()=>renderFlashcardChannel(t,e),whiteboard:()=>renderWhiteboardChannel(t,e),code:()=>renderCodeChannel(t,e),reminder:()=>renderReminderChannel(t,e),crypt:()=>renderCryptChannel(t,e),settings:()=>renderSettingsChannel(t,e)}[e.type]||(()=>{}))()},renderTextChannel=(e,t)=>{const n=createElement("div",{class:"chat-container",style:{height:"95%"}});e.appendChild(n);const a=createElement("div",{class:"messages-area"});n.appendChild(a);const l=()=>{a.innerHTML="";const e=document.createDocumentFragment();(chatMessages[t.id]||[]).forEach(((n,a)=>{const r=createElement("div",{class:"message-container"});r.appendChild(createElement("div",{class:"message-date"},n.date));const i=createElement("div",{class:"message-content"}),s=createElement("span");if(n.text.split(/(https?:\/\/\S+|www\.\S+)/gi).forEach(((e,t)=>{if(e)if(t%2){let t=e;/^www\./i.test(e)&&(t="http://"+e);try{new URL(t),s.appendChild(createElement("a",{href:t,target:"_blank",rel:"noopener noreferrer"},e))}catch{s.appendChild(document.createTextNode(e))}}else e.split("\n").forEach(((e,t,n)=>{s.appendChild(document.createTextNode(e)),t<n.length-1&&s.appendChild(createElement("br"))}))})),i.appendChild(s),n.files?.length){const e=createElement("div",{class:"files-container"});n.files.forEach((t=>{const n=createElement("div",{style:{position:"relative"}});if(t.type.startsWith("image/")){const e=createElement("img",{src:t.content,style:{maxWidth:"200px",cursor:"pointer"}});e.addEventListener("click",(()=>o(t.content))),n.appendChild(e)}else if(t.type.startsWith("audio/"))n.appendChild(createElement("audio",{src:t.content,controls:!0}));else if(!t.type.startsWith("image/")&&!t.type.startsWith("audio/")){new Blob([t.content]).size>25e4?n.textContent=t.name:n.appendChild(createElement("pre",{style:{maxHeight:"150px",overflow:"auto"}},t.content))}n.appendChild(createElement("button",{class:"download-btn",onclick:()=>{const e=createElement("a");if(t.type.startsWith("image/")||t.type.startsWith("audio/"))e.href=t.content;else{const n=new Blob([t.content],{type:t.type||"text/plain"});e.href=URL.createObjectURL(n)}e.download=t.name,e.click()}},"Download")),e.appendChild(n)})),i.appendChild(e)}r.appendChild(i);const c=createElement("div",{class:"message-toolbar"});c.appendChild(createElement("button",{class:"edit-btn",onclick:()=>{const e=createElement("form"),t=n.text.split("\n").length,a=createElement("textarea",{class:"message-edited",rows:t,value:n.text});e.appendChild(a);let i=n.files.slice();const s=createElement("div"),c=()=>{s.innerHTML="",i.forEach(((e,t)=>{const n=createElement("div",{style:{position:"relative"}});if(e.type.startsWith("image/")){const t=createElement("img",{src:e.content,style:{maxWidth:"200px",cursor:"pointer"}});t.addEventListener("click",(()=>o(e.content))),n.appendChild(t)}else if(e.type.startsWith("audio/"))n.appendChild(createElement("audio",{src:e.content,controls:!0}));else{new Blob([e.content]).size>25e4?n.textContent=e.name:n.appendChild(createElement("pre",{style:{maxHeight:"150px",overflow:"auto"}},e.content))}n.appendChild(createElement("button",{type:"button",class:"remove-btn",style:{position:"absolute",top:"0px",right:"0px"},onclick:()=>{i.splice(t,1),c()}},"Remove")),s.appendChild(n)}))};c(),e.appendChild(s);const d=createElement("input",{type:"file",multiple:!0,style:{display:"none"}}),p=createElement("button",{type:"button",onclick:e=>{e.preventDefault(),d.click()}},"Attach File");e.appendChild(p),e.appendChild(d),d.addEventListener("change",(async()=>{for(const e of d.files)i.push(await readFileAsync(e));c(),d.value=""}));const h=createElement("button",{type:"submit"},"Save"),u=createElement("button",{type:"button",onclick:l},"Cancel");e.appendChild(h),e.appendChild(u);const m=r.querySelector(".message-content");m.innerHTML="",m.appendChild(e),e.addEventListener("submit",(e=>{e.preventDefault(),n.text=a.value,n.files=i,l()}))}},"Edit")),c.appendChild(createElement("button",{class:"remove-btn",onclick:()=>{chatMessages[t.id].splice(a,1),l()}},"Remove")),r.appendChild(c),e.appendChild(r)})),a.appendChild(e)},o=e=>{const t=createElement("div",{class:"image-overlay"}),n=createElement("img",{src:e});t.appendChild(n),t.addEventListener("click",(e=>{e.target===t&&(t.classList.remove("show"),setTimeout((()=>t.remove()),100))})),document.body.appendChild(t),setTimeout((()=>t.classList.add("show")),0)};chatMessages[t.id]=chatMessages[t.id]||[],l();const r=createElement("div",{style:{display:"flex",flexWrap:"wrap",marginLeft:"auto"}});r.appendChild(createElement("button",{type:"button",onclick:()=>{const e=chatMessages[t.id]||[],n=new Blob([JSON.stringify(e,null,2)],{type:"application/json"});createElement("a",{href:URL.createObjectURL(n),download:"chat.json"}).click()}},"Export"));const i=createElement("input",{type:"file",accept:"application/json",style:{display:"none"},onchange:async e=>{const n=e.target.files[0];if(!n)return;const a=await readFileAsync(n);try{const e=JSON.parse(a.content);Array.isArray(e)&&(chatMessages[t.id]=chatMessages[t.id]||[],e.forEach((e=>{e.id||(e.id=Date.now()+Math.random());const n=chatMessages[t.id].findIndex((t=>t.id===e.id));-1!==n?chatMessages[t.id][n]=e:chatMessages[t.id].push(e)})),l())}catch{}}});i.addEventListener("click",(()=>{i.value=""})),r.appendChild(i),r.appendChild(createElement("button",{type:"button",onclick:()=>i.click()},"Import")),n.insertBefore(r,a);const s=createElement("div",{class:"input-container",style:{display:"flex",overflowX:"auto"}});n.appendChild(s);const c=createElement("div",{class:"chat-toolbar"}),d=createElement("textarea",{rows:"1",placeholder:"Type a message...",style:{flex:"1",minWidth:"100px",maxWidth:"calc(100% - 120px)"},onkeydown:e=>{"Enter"!==e.key||e.shiftKey||e.isComposing||(e.preventDefault(),m.dispatchEvent(new Event("submit",{cancelable:!0})))}});c.appendChild(d);const p=createElement("input",{type:"file",multiple:!0,style:{display:"none"}});c.appendChild(createElement("button",{type:"button",onclick:()=>p.click()},"Attach File")),c.appendChild(p),c.appendChild(createElement("button",{type:"submit"},"Send")),n.appendChild(c);let h=[];const u=()=>{s.innerHTML="",h.forEach(((e,t)=>{const n=createElement("div",{class:"file-item"},e.name);n.appendChild(createElement("button",{class:"remove-btn",onclick:()=>{h.splice(t,1),u()}},"Remove")),s.appendChild(n)}))};p.addEventListener("change",(async()=>{for(const e of p.files)h.push(await readFileAsync(e));u(),p.value=""}));const m=createElement("form",{onsubmit:e=>{e.preventDefault();const n=d.value;("string"==typeof n&&""!==n.trim()||h.length)&&(chatMessages[t.id].push({id:Date.now()+"_"+Math.random().toString(36).substring(2,9),date:(new Date).toLocaleString(),text:n,files:h}),l(),d.value="",h=[],u(),a.scrollTop=a.scrollHeight)}});m.appendChild(s),m.appendChild(c),n.appendChild(m)},renderFlashcardChannel=(e,t)=>{e.innerHTML="";const n=createElement("div",{class:"flashcard-toolbar",style:{display:"flex",justifyContent:"space-between",alignItems:"center"}}),a=createElement("div",{style:{display:"flex",flexWrap:"wrap",marginLeft:"auto"}});a.appendChild(createElement("button",{type:"button",onclick:()=>{const e=flashcards[t.id]||[],n=new Blob([JSON.stringify(e,null,2)],{type:"application/json"});createElement("a",{href:URL.createObjectURL(n),download:"flashcards.json"}).click()}},"Export"));const l=createElement("input",{type:"file",accept:"application/json",style:{display:"none"},onchange:async e=>{const n=e.target.files[0];if(!n)return;const a=await readFileAsync(n);try{const e=JSON.parse(a.content);Array.isArray(e)&&(flashcards[t.id]=flashcards[t.id]||[],e.forEach((e=>{const n=flashcards[t.id].findIndex((t=>t.question===e.question));-1!==n?flashcards[t.id][n]=e:flashcards[t.id].push(e)})),f())}catch{}}});l.addEventListener("click",(()=>{l.value=""})),a.appendChild(l),a.appendChild(createElement("button",{type:"button",onclick:()=>l.click()},"Import")),n.appendChild(a),e.appendChild(n);const o=createElement("div"),r=createElement("div"),i=createElement("form",{class:"flashcard-form",style:{display:"flex",flexWrap:"wrap",flexDirection:"column",marginRight:"10px"},onsubmit:e=>{e.preventDefault();const n=s.value.trim();if(!n)return;const a=Array.from(u.querySelectorAll(".answer-row")).map((e=>{const[t,n]=e.querySelectorAll("input");return n.value.trim()?{text:n.value,correct:t.checked}:null})).filter((e=>e));a.length&&(flashcards[t.id]=flashcards[t.id]||[],flashcards[t.id].push({question:n,answers:a}),s.value="",u.innerHTML="",m(),f())}}),s=createElement("input",{type:"text",placeholder:"Enter question here",required:!0});i.appendChild(s);const c=createElement("div",{style:{display:"flex"}}),d=createElement("button",{type:"button",onclick:()=>m()},"Add Answer"),p=createElement("button",{type:"submit"},"Add Flashcard"),h=createElement("button",{type:"button"},"Start Test");c.appendChild(d),c.appendChild(p),c.appendChild(h),i.appendChild(c);const u=createElement("div",{id:"answers-container",style:{display:"flex",flexDirection:"column"}});i.appendChild(u);const m=(e="",t=!1)=>{const n=createElement("div",{class:"answer-row",style:{display:"flex",alignItems:"center"}});n.appendChild(createElement("input",{type:"checkbox",title:"Mark as correct answer",checked:t})),n.appendChild(createElement("input",{type:"text",placeholder:"Answer",required:!0,value:e,style:{flex:"1"}})),n.appendChild(createElement("button",{type:"button",class:"remove-btn",onclick:()=>n.remove()},"Remove")),u.appendChild(n)};m(),r.appendChild(i);const y=createElement("div");r.appendChild(y);const v=createElement("div",{style:{display:"none"}});o.appendChild(r),o.appendChild(v),e.appendChild(o);const f=()=>{y.innerHTML="",(flashcards[t.id]=flashcards[t.id]||[]).forEach(((e,n)=>{const a=createElement("div",{class:"flashcard"}),l=createElement("p",{},"Q: "+e.question);a.appendChild(l);const o=createElement("div");e.answers.forEach((e=>{const t=createElement("div",{class:e.correct?"correct-highlight":"",style:{display:"flex",alignItems:"center"}}),n=createElement("input",{type:"checkbox",checked:e.correct,disabled:!0});t.appendChild(n),t.appendChild(document.createTextNode(e.text)),o.appendChild(t)})),a.appendChild(o);const r=createElement("div",{class:"toolbar"}),i=createElement("button",{type:"button",onclick:function(){if("Edit"===this.textContent){const t=createElement("input",{type:"text",value:e.question,style:{width:"100%"}});a.replaceChild(t,l);const n=createElement("div");e.answers.forEach((e=>{const t=createElement("div",{class:"answer-row",style:{display:"flex",alignItems:"center"}});t.appendChild(createElement("input",{type:"checkbox",checked:e.correct})),t.appendChild(createElement("input",{type:"text",value:e.text,style:{flex:"1"}})),n.appendChild(t)})),a.replaceChild(n,o);const i=createElement("button",{type:"button",onclick:()=>{const e=createElement("div",{class:"answer-row",style:{display:"flex",alignItems:"center"}});e.appendChild(createElement("input",{type:"checkbox"})),e.appendChild(createElement("input",{type:"text",placeholder:"New answer",style:{flex:"1"}})),n.appendChild(e)}},"Add Answer");r.insertBefore(i,this.nextSibling),this.textContent="Save"}else{const t=a.querySelector("input[type='text']");e.question=t.value;const n=[];a.querySelectorAll(".answer-row").forEach((e=>{const[t,a]=e.querySelectorAll("input");a.value.trim()&&n.push({text:a.value,correct:t.checked})})),e.answers=n;const l=r.querySelector("button:nth-child(3)");l&&"Add Answer"===l.textContent&&r.removeChild(l),f()}}},"Edit");r.appendChild(i),r.appendChild(createElement("button",{type:"button",class:"remove-btn",onclick:()=>{flashcards[t.id].splice(n,1),f()}},"Remove")),a.appendChild(r),y.appendChild(a)})),h.disabled=!flashcards[t.id]?.length};f(),h.addEventListener("click",(()=>{r.style.display="none",g(v,t),v.style.display="block"}));const g=(e,t)=>{e.innerHTML="";const n=[...flashcards[t.id]||[]].sort((()=>Math.random()-.5));if(!n.length)return void(e.textContent="No flashcards available for testing.");const a=n.map((e=>{const t=e.answers.slice();for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return{question:e.question,answers:t}})),l=createElement("form",{onsubmit:e=>{e.preventDefault();let t=0;a.forEach(((e,n)=>{const a=Array.from(l.querySelectorAll(`input[name="card${n}"]:checked`)).map((e=>+e.value)),o=e.answers.map(((e,t)=>e.correct?t:null)).filter((e=>null!==e));a.sort().toString()===o.sort().toString()&&t++,l.querySelectorAll(`input[name="card${n}"]`).forEach((e=>{const t=+e.value;o.includes(t)?e.parentElement.classList.add("correct-highlight"):e.checked&&e.parentElement.classList.add("incorrect-highlight"),e.disabled=!0}))})),l.querySelector("button[type='submit']").disabled=!0,l.appendChild(createElement("div",{},`Your score: ${t} / ${a.length}`))}});a.forEach(((e,t)=>{const n=createElement("div");n.appendChild(createElement("p",{},"Q: "+e.question)),e.answers.forEach(((e,a)=>{const l=createElement("label",{style:{display:"flex",alignItems:"center"}});l.appendChild(createElement("input",{type:"checkbox",name:`card${t}`,value:a})),l.appendChild(document.createTextNode(e.text)),n.appendChild(l)})),l.appendChild(n)})),l.appendChild(createElement("button",{type:"submit"},"Submit Answers")),l.appendChild(createElement("button",{type:"button",onclick:()=>{e.style.display="none",r.style.display="block"}},"Back")),e.appendChild(l)}},renderWhiteboardChannel=(e,t)=>{e.innerHTML="",Object.assign(e.style,{display:"flex",flexDirection:"column"});const n=createElement("div",{style:{display:"flex",flexDirection:"column"}}),a=30,l="#6e6e6e",o=(e,t,n=1)=>{if(e.length<=2)return e;const a=n/t,[l,r]=e[0],[i,s]=e[e.length-1],c=l===i&&r===s;if(c&&e.length<4)return e;let d=0,p=0;for(let t=1;t<e.length-1;t++){const[n,a]=e[t],o=Math.abs((s-r)*n-(i-l)*a+i*r-s*l)/Math.sqrt((s-r)**2+(i-l)**2);o>d&&(d=o,p=t)}if(d>a){const a=o(e.slice(0,p+1),t,n),l=o(e.slice(p),t,n);return a.slice(0,-1).concat(l)}return c?e:[e[0],e[e.length-1]]},r=(e,t)=>{let n=R*W%a,l=F*W%a;return n<0&&(n+=a),l<0&&(l+=a),{x:n+Math.round((e-n)/a)*a,y:l+Math.round((t-l)/a)*a}},i=(e,t,n,a)=>{for(let l=1;l<e.points.length;l++){const[o,r]=e.points[l-1],[i,s]=e.points[l],c=i-o,d=s-r,p=c*c+d*d;let h=0!==p?((t-o)*c+(n-r)*d)/p:-1;h=Math.max(0,Math.min(1,h));const u=t-(o+h*c),m=n-(r+h*d);if(Math.sqrt(u*u+m*m)<=a+e.size/2)return!0}return!1},s=e=>createElement("button",{onclick:()=>{const t=k.width/2,n=k.height/2,a=e?2*W:W/2;R+=t*(1/a-1/W),F+=n*(1/a-1/W),W=a,D.panZoom={offsetX:R,offsetY:F,scale:W},oe()}},e?"Zoom In":"Zoom Out"),c=createElement("div",{class:"toolbar",style:{display:"flex"}}),d=createElement("button",{onclick:()=>{Z=!Z,_=!1,u.style.backgroundColor="",H=!1,m.style.backgroundColor="",P=!1,g.style.backgroundColor="",d.style.backgroundColor=Z?"var(--color-accent)":"",Y=null,k.style.cursor="none",oe()}},"Brush"),p=createElement("input",{type:"color",value:"#ffffff",oninput:e=>{O=e.target.value,_=!1,u.style.backgroundColor="",H=!1,m.style.backgroundColor="",P=!1,g.style.backgroundColor="",Y=null,k.style.cursor="none",oe()}}),h=createElement("input",{type:"range",min:"1",max:"20",value:"1",onchange:e=>{N=+e.target.value,se()}}),u=createElement("button",{onclick:()=>{_=!_,Z=!1,d.style.backgroundColor="",H=!1,m.style.backgroundColor="",P=!1,g.style.backgroundColor="",u.style.backgroundColor=_?"#ff0000":"",Y=null,k.style.cursor="none",se()}},"Eraser"),m=createElement("button",{onclick:()=>{H=!H,Z=!1,d.style.backgroundColor="",_=!1,u.style.backgroundColor="",P=!1,g.style.backgroundColor="",m.style.backgroundColor=H?"var(--color-accent)":"",Y=null,k.style.cursor="none",oe()}},"Pan"),y=s(!0),v=s(!1),f=createElement("button",{onclick:()=>{$=!$,f.style.backgroundColor=$?"var(--color-accent)":""}},"Snap"),g=createElement("button",{onclick:()=>{P=!P,Z=!1,d.style.backgroundColor="",_=!1,u.style.backgroundColor="",H=!1,m.style.backgroundColor="",g.style.backgroundColor=P?"var(--color-accent)":"",P?(k.style.cursor="crosshair",b.disabled=!1,C.disabled=!1):(k.style.cursor="none",b.disabled=!0,C.disabled=!0,z=null,Y=null,oe())}},"Select"),b=createElement("button",{onclick:()=>ue(!1),disabled:!0},"Copy"),C=createElement("button",{onclick:()=>ue(!0),disabled:!0},"Cut"),E=createElement("input",{type:"file",accept:"image/*",style:{display:"none"},onchange:e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=()=>{const t=e.result,n=new Image;n.onload=()=>{const e=n.naturalWidth,a=n.naturalHeight,l=.2*(k.width/W),o=l*(a/e),r=ae(k.width/2),i=le(k.height/2),s={dataUrl:t,x:r-l/2,y:i-o/2,width:l,height:o};I.push(s),A.push(n),oe()},n.src=t},e.readAsDataURL(t)}}});n.appendChild(E);const x=createElement("button",{onclick:()=>{E.click()}},"Attach");c.append(d,p,h,u,m,y,v,f,g,b,C,x),n.appendChild(c),e.appendChild(n);const w=createElement("div",{style:{flex:"1",position:"relative",overflow:"hidden"}});e.appendChild(w);const k=createElement("canvas");k.style.cursor="none",w.appendChild(k);const S=k.getContext("2d");k.classList.add("whiteboard-context"),document.oncontextmenu=()=>!1,window.whiteboardData[t.id]=window.whiteboardData[t.id]||{paths:[],images:[],panZoom:{offsetX:0,offsetY:0,scale:1}};const D=window.whiteboardData[t.id],L=D.paths,I=D.images,A=[];I.forEach((e=>{const t=new Image;t.onload=()=>{oe()},t.src=e.dataUrl,A.push(t)}));let M,T,{offsetX:R,offsetY:F,scale:W}=D.panZoom,j=0,q=0,B=0,U=0,O="#fff",N=1,_=!1,H=!1,$=!1,P=!1,z=null,Y=null,G=0,J=0,X=null,K=!1,Z=!1,Q=null,V=!1,ee=null;const te=e=>(e+R)*W,ne=e=>(e+F)*W,ae=e=>e/W-R,le=e=>e/W-F,oe=()=>{k.width=w.clientWidth,k.height=w.clientHeight,S.clearRect(0,0,k.width,k.height),S.fillStyle="#202124",S.fillRect(0,0,k.width,k.height);let e=R*W%a,t=F*W%a;e<0&&(e+=a),t<0&&(t+=a),S.fillStyle=l;for(let n=e;n<k.width;n+=a)for(let e=t;e<k.height;e+=a)S.beginPath(),S.arc(n,e,1,0,2*Math.PI),S.fill();I.forEach(((e,t)=>{const n=A[t];if(n&&n.complete){const t=te(e.x),a=ne(e.y),l=e.width*W,o=e.height*W;S.drawImage(n,t,a,l,o)}}));const n=e=>{S.beginPath();const t=e.points;if(t.length<2)return;const[n,a]=t[0];if(S.moveTo(te(n),ne(a)),e.snapped)for(let e=1;e<t.length;e++){const[n,a]=t[e];S.lineTo(te(n),ne(a))}else if(2===t.length){const[e,n]=t[1];S.lineTo(te(e),ne(n))}else{for(let e=1;e<t.length-1;e++){const[n,a]=t[e-1],[l,o]=t[e],[r,i]=t[e+1],s=l,c=o,d=(l+r)/2,p=(o+i)/2;S.quadraticCurveTo(te(s),ne(c),te(d),ne(p))}const[e,n]=t[t.length-1];S.lineTo(te(e),ne(n))}S.strokeStyle=e.color,S.lineWidth=e.size,S.lineCap="round",S.stroke()};if(L.forEach(n),X&&n(X),re(),z&&ie(),Q){const e=te(Q.x+Q.width),t=ne(Q.y);S.save(),S.fillStyle="red",S.beginPath(),S.arc(e,t,10,0,2*Math.PI),S.fill(),S.strokeStyle="white",S.lineWidth=2,S.beginPath(),S.moveTo(e-5,t-5),S.lineTo(e+5,t+5),S.moveTo(e+5,t-5),S.lineTo(e-5,t+5),S.stroke(),S.restore()}},re=()=>{if(!H)return;const e=k.width/2,t=k.height/2;S.save(),S.strokeStyle=l,S.lineWidth=1,S.beginPath(),S.moveTo(0,t),S.lineTo(k.width,t),S.stroke(),S.beginPath(),S.moveTo(e,0),S.lineTo(e,k.height),S.stroke(),S.restore()},ie=()=>{if(!z)return;const e=Math.min(z.x0,z.x1),t=Math.max(z.x0,z.x1),n=Math.min(z.y0,z.y1),a=Math.max(z.y0,z.y1),l=te(e),o=ne(n),r=te(t)-l,i=ne(a)-o;S.save(),S.strokeStyle="#6e6e6e",S.lineWidth=2,S.setLineDash([5,5]),S.strokeRect(l,o,r,i),S.restore()},se=()=>{if(oe(),P&&Y){let e=ae(j)-G/2,t=le(q)-J/2;if($){const n=r(te(e),ne(t));e=ae(n.x),t=le(n.y)}S.save(),S.globalAlpha=.5,Y.forEach((n=>{S.beginPath();const[a,l]=n.points[0];S.moveTo(te(a+e),ne(l+t));for(let a=1;a<n.points.length;a++){const[l,o]=n.points[a];S.lineTo(te(l+e),ne(o+t))}S.strokeStyle=n.color,S.lineWidth=n.size*W,S.lineCap="round",S.stroke()})),S.restore()}else{const e=_?4*N:N;S.beginPath(),S.arc(j,q,e/2,0,2*Math.PI),S.strokeStyle=_?"red":"white",S.lineWidth=1,S.stroke()}},ce=(e,t)=>{const n=e.getBoundingClientRect();return{x:t.touches[0].clientX-n.left,y:t.touches[0].clientY-n.top}},de=(e,t)=>{const n=ae(e),a=le(t);if(Q){const n=e-te(Q.x+Q.width),a=t-ne(Q.y);if(Math.sqrt(n*n+a*a)<10){const e=I.indexOf(Q);return-1!==e&&(I.splice(e,1),A.splice(e,1)),Q=null,void oe()}}const l=((e,t)=>{for(let n=I.length-1;n>=0;n--){const a=I[n];if(e>=a.x&&e<=a.x+a.width&&t>=a.y&&t<=a.y+a.height)return a}return null})(n,a);if(l&&!Z&&!_&&!H&&!P)return Q=l,V=!0,ee=l,M=n-l.x,T=a-l.y,void oe();if(Q=null,K=!0,P&&Y){let n=ae(e)-G/2,a=le(t)-J/2;if($){const e=r(te(n),ne(a));n=ae(e.x),a=le(e.y)}return Y.forEach((e=>{L.push({points:e.points.map((([e,t])=>[e+n,t+a])),color:e.color,size:e.size})})),void oe()}if(Z&&!_&&!H&&!P){const e=$?r(te(n),ne(a)):{x:te(n),y:ne(a)};X={points:[[ae(e.x),le(e.y)]],color:O,size:N,snapped:$}}P&&!Y&&(z={x0:n,y0:a,x1:n,y1:a}),j=B=e,q=U=t},pe=(e,t)=>{j=e,q=t;const n=ae(e),a=le(t);if(e<0||e>k.width||t<0||t>k.height)return K&&X&&Z&&(X.points=o(X.points,W),L.push(X),X=null,K=!1,oe()),void requestAnimationFrame(se);if(V)ee.x=n-M,ee.y=a-T,oe();else if(K){if(H)R+=(j-B)/W,F+=(q-U)/W,D.panZoom={offsetX:R,offsetY:F,scale:W},oe();else if(_){const e=n,t=a;for(let n=L.length-1;n>=0;n--)i(L[n],e,t,N/W*2)&&L.splice(n,1);oe()}else if(P&&!Y&&z)z.x1=n,z.y1=a,oe();else if(X&&Z){const e=$?r(te(n),ne(a)):{x:te(n),y:ne(a)};X.points.push([ae(e.x),le(e.y)]),oe()}B=j,U=q}requestAnimationFrame(se)},he=()=>{V?(V=!1,ee=null):K&&(X&&(X.points.length>1&&(X.points=o(X.points,W),L.push(X)),X=null,oe()),K=!1)},ue=e=>{if(!z)return;const t=Math.min(z.x0,z.x1),n=Math.max(z.x0,z.x1),a=Math.min(z.y0,z.y1),l=Math.max(z.y0,z.y1);G=n-t,J=l-a;const o=[],r=[];for(let i=0;i<L.length;i++){const s=L[i];me(s,t,a,n,l)&&(o.push(s),e&&r.push(i))}if(Y=o.map((e=>({points:e.points.map((([e,n])=>[e-t,n-a])),color:e.color,size:e.size}))),e&&r.length>0)for(let e=r.length-1;e>=0;e--)L.splice(r[e],1);z=null,b.disabled=!Y,C.disabled=!Y,oe()};k.addEventListener("mousedown",(e=>{0===e.button&&de(e.offsetX,e.offsetY)})),k.addEventListener("touchstart",(e=>{e.preventDefault();const t=ce(k,e);de(t.x,t.y)})),k.addEventListener("mousemove",(e=>pe(e.offsetX,e.offsetY))),k.addEventListener("touchmove",(e=>{e.preventDefault();const t=ce(k,e);pe(t.x,t.y)})),k.addEventListener("mouseup",he),k.addEventListener("touchend",(e=>{e.preventDefault(),he()})),k.addEventListener("mouseleave",(()=>{K&&X&&Z&&(X.points=o(X.points,W),L.push(X),X=null,K=!1,oe())})),k.addEventListener("touchcancel",(e=>{e.preventDefault(),he()}));const me=(e,t,n,a,l)=>{for(let o=1;o<e.points.length;o++){const[r,i]=e.points[o-1],[s,c]=e.points[o];if(r>=t&&r<=a&&i>=n&&i<=l||s>=t&&s<=a&&c>=n&&c<=l)return!0;if(ye(r,i,s,c,t,n,a,l))return!0}return!1},ye=(e,t,n,a,l,o,r,i)=>{const s=ve(e,t,n,a,l,o,l,i),c=ve(e,t,n,a,r,o,r,i),d=ve(e,t,n,a,l,o,r,o),p=ve(e,t,n,a,l,i,r,i);return s||c||d||p},ve=(e,t,n,a,l,o,r,i)=>{const s=(i-o)*(n-e)-(r-l)*(a-t);if(0===s)return!1;const c=((r-l)*(t-o)-(i-o)*(e-l))/s,d=((n-e)*(t-o)-(a-t)*(e-l))/s;return c>=0&&c<=1&&d>=0&&d<=1};window.addEventListener("resize",oe),oe()},renderCodeChannel=(container,channel)=>{container.innerHTML="",container.style.display="flex",container.style.flexDirection="column";const headerContainer=createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}}),buttonContainer=createElement("div",{style:{display:"flex",flexWrap:"wrap",marginLeft:"auto"}}),saveButton=createElement("button",{},"Save");buttonContainer.appendChild(saveButton),buttonContainer.appendChild(createElement("button",{onclick:()=>{const e=channelCategories.find((e=>"Functions"===e.name));if(!e?.channels?.length)return;const t=new Blob([JSON.stringify(e.channels,null,2)],{type:"application/json"});createElement("a",{href:URL.createObjectURL(t),download:"code_functions.json"}).click()}},"Export")),buttonContainer.appendChild(createElement("button",{onclick:()=>{const e=createElement("input",{type:"file",accept:"application/json",style:{display:"none"}});e.addEventListener("change",(async e=>{const t=e.target.files[0];if(!t)return;const n=await readFileAsync(t);try{const e=JSON.parse(n.content);if(Array.isArray(e)){let t=channelCategories.find((e=>"Functions"===e.name));t||(t={name:"Functions",channels:[]},channelCategories.push(t)),e.forEach((e=>{const n=t.channels.findIndex((t=>t.name.toLowerCase()===e.name.toLowerCase()));-1!==n?t.channels[n]=e:t.channels.push(e)})),renderSidebar()}}catch{}})),e.click()}},"Import")),headerContainer.appendChild(buttonContainer),container.appendChild(headerContainer);const ioContainer=createElement("div",{class:"toolbar",style:{display:"flex",alignItems:"center"}}),functionNameInput=createElement("input",{type:"text",placeholder:"Function Name..",style:{flex:"1",minWidth:"80px"}});ioContainer.appendChild(functionNameInput),container.appendChild(ioContainer);const wrapper=createElement("div",{class:"code-runner-wrapper",style:{flex:"1",position:"relative",display:"grid",gridTemplateRows:"1fr 100px",overflow:"hidden"}});container.appendChild(wrapper);const runButton=createElement("button",{class:"run-btn"},"Run Code");wrapper.appendChild(runButton);const codeTextarea=createElement("textarea",{class:"code-runner-textarea"});wrapper.appendChild(codeTextarea),window.codeData[channel.id]&&(codeTextarea.value=window.codeData[channel.id]),codeTextarea.addEventListener("input",(()=>{window.codeData[channel.id]=codeTextarea.value}));const outputDiv=createElement("div",{class:"code-runner-output"});wrapper.appendChild(outputDiv),runButton.addEventListener("click",(()=>{const code=codeTextarea.value,logs=[],originalLog=console.log;console.log=(...e)=>{logs.push(e.join(" ")),originalLog(...e)};try{const result=eval(code);outputDiv.textContent=logs.length?logs.join("\n"):void 0!==result?result:"Code executed successfully."}catch(e){outputDiv.textContent="Error: "+e}console.log=originalLog})),functionNameInput.addEventListener("input",(()=>{const e=channelCategories.find((e=>"Functions"===e.name));saveButton.textContent=e&&e.channels.find((e=>e.name.toLowerCase()===functionNameInput.value.trim().toLowerCase()))?"Update":"Save"})),saveButton.addEventListener("click",(()=>{const e=codeTextarea.value;if(!e.trim())return;let t=channelCategories.find((e=>"Functions"===e.name));t||(t={name:"Functions",channels:[]},channelCategories.push(t));let n=functionNameInput.value.trim()||"Saved Function "+(t.channels.length+1);const a=t.channels.findIndex((e=>e.name.toLowerCase()===n.toLowerCase()));if(-1!==a)t.channels[a].code=e;else{const a="func_"+Date.now()+"_"+Math.random().toString(36).substring(2,9);t.channels.push({id:a,name:n,type:"function",code:e})}renderSidebar(),functionNameInput.value="",saveButton.textContent="Save"}))},renderReminderChannel=(e,t)=>{e.innerHTML="";const n=e=>{const{r:t,g:n,b:a}=(e=>{if((e=e.trim().toLowerCase()).startsWith("#")){let t=e.slice(1);return[3,4].includes(t.length)&&(t=t.split("").map((e=>e+e)).join("")),{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16)}}if(e.startsWith("rgb")){const t=e.match(/(\d+)/g)||[];return{r:+t[0]||0,g:+t[1]||0,b:+t[2]||0}}return{r:255,g:255,b:255}})(e),l=e=>(e/=255)<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4);return.2126*l(t)+.7152*l(n)+.0722*l(a)>.179?"#000000":"#ffffff"};reminders[t.id]=reminders[t.id]||[];const a=createElement("div");e.appendChild(a);const l=()=>{a.innerHTML="",reminders[t.id].forEach(((e,o)=>{const r=createElement("div",{class:"reminder-container",style:{backgroundColor:e.color,color:n(e.color),borderRadius:"4px",position:"relative",padding:"8px 28px 8px 8px"}});e.date&&r.appendChild(createElement("div",{},new Date(e.date).toLocaleString())),r.appendChild(createElement("div",{},e.text)),r.appendChild(createElement("button",{class:"remove-btn",style:{position:"absolute",top:"0",right:"0",padding:"2px 8px",border:"none",background:"transparent",color:"inherit",cursor:"pointer",fontSize:"14px",borderRadius:"0 4px 0 4px"},onclick:()=>{reminders[t.id].splice(o,1),l()}},"×")),a.appendChild(r)}))};l();const o=createElement("form",{onsubmit:e=>{e.preventDefault(),reminders[t.id].push({date:r.value||null,text:i.value,color:s.value}),r.value="",i.value="",l()},style:{display:"flex",flexWrap:"wrap",alignItems:"center"}}),r=createElement("input",{type:"datetime-local"}),i=createElement("input",{type:"text",placeholder:"Reminder text",required:!0}),s=createElement("input",{type:"color",value:"#007bff"});o.append(r,i,s,createElement("button",{type:"submit"},"Add Reminder")),e.appendChild(o)},renderCryptChannel=(e,t)=>{e.innerHTML="";const n=createElement("div",{class:"crypt-container",style:{display:"flex",flexDirection:"column"}}),a=createElement("div",{style:{display:"flex",justifyContent:"space-between",flexWrap:"wrap"}});let l=!1,o="",r="";const i=createElement("div",{style:{flex:"1",marginRight:"5px"}}),s=createElement("textarea",{placeholder:"Enter your message here",rows:"10",class:"crypt-textarea"}),c=createElement("button",{onclick:()=>{navigator.clipboard.writeText(s.value)},disabled:!0},"Copy Message"),d=createElement("button",{onclick:()=>{u.click()}},"Attach File"),p=createElement("button",{onclick:()=>{l=!1,o="",r="",s.disabled=!1,v.disabled=!0,s.value="",v.value="",s.placeholder="Enter your message here",v.placeholder="The result will appear here",p.style.display="none",d.style.display="inline",h.textContent="",c.disabled=!s.value,b.disabled=!v.value&&!v._binaryData,g.disabled=!v.value},style:{display:"none"}},"Clear File"),h=createElement("div",{style:{marginTop:"5px",fontSize:"12px",color:"#666"}}),u=createElement("input",{type:"file",style:{display:"none"}});u.addEventListener("click",(()=>{u.value=""})),u.addEventListener("change",(function(){if(u.files&&u.files[0]){const e=u.files[0];o=e.name,r=e.type||"application/octet-stream",l=!0,s.disabled=!0,v.disabled=!0,c.disabled=!0,b.disabled=!0,s.placeholder="File content loaded (binary data)",v.placeholder="Encrypted/Decrypted file content will appear here",p.style.display="inline",d.style.display="none",h.textContent=`File: ${o} (${T(e.size)})`;const t=new FileReader;t.onload=e=>{const t=e.target.result,n=new Uint8Array(t);s.value="_BINARY_DATA_",s._binaryData=n},t.readAsArrayBuffer(e)}})),i.appendChild(s);const m=createElement("div",{style:{display:"flex",justifyContent:"space-between"}});m.appendChild(d),m.appendChild(p),m.appendChild(c),i.appendChild(m),i.appendChild(h),i.appendChild(u),a.appendChild(i);const y=createElement("div",{style:{flex:"1",marginLeft:"5px"}}),v=createElement("textarea",{placeholder:"The result will appear here",disabled:!0,rows:"10",class:"crypt-textarea"}),f=createElement("div",{style:{marginTop:"5px",fontSize:"12px",color:"#666"}}),g=createElement("button",{onclick:()=>{navigator.clipboard.writeText(v.value)},disabled:!0},"Copy Result"),b=createElement("button",{onclick:()=>{if(l&&v._binaryData){let e=o;if(e.includes(".")){const t=e.split(".");t.pop();const n=t.join(".");e=e.endsWith(".enc")?n:`${e}.enc`}else e=`${e}.enc`;const t=new Blob([v._binaryData],{type:r}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}else{const e=new Blob([v.value],{type:"text/plain"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="result.txt",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}},disabled:!0},"Download");y.appendChild(v);const C=createElement("div",{style:{display:"flex",justifyContent:"space-between"}});C.appendChild(b),C.appendChild(g),y.appendChild(C),y.appendChild(f),a.appendChild(y),n.appendChild(a);const E=createElement("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",marginTop:"10px"}}),x=createElement("label",{},"Password Length: "),w=createElement("input",{type:"range",min:"6",max:"200",value:"12",oninput:e=>{k.textContent=e.target.value}}),k=createElement("span",{},w.value);x.appendChild(w),x.appendChild(k),E.appendChild(x);const S=createElement("button",{onclick:()=>{const e=parseInt(w.value,10);A.value=W(e),M.disabled=!1,j(),q()}},"Generate"),D=createElement("button",{disabled:!0},"Encrypt"),L=createElement("button",{disabled:!0},"Decrypt");E.appendChild(S),E.appendChild(D),E.appendChild(L),n.appendChild(E);const I=createElement("div",{style:{display:"flex",alignItems:"center",marginTop:"10px"}}),A=createElement("input",{type:"text",placeholder:"Enter encryption key",class:"crypt-textarea",style:{flex:"1"}}),M=createElement("button",{onclick:()=>{navigator.clipboard.writeText(A.value)},disabled:!0},"Copy Key");I.appendChild(A),I.appendChild(M),n.appendChild(I),e.appendChild(n);const T=e=>e<1024?e+" bytes":e<1048576?(e/1024).toFixed(2)+" KB":(e/1048576).toFixed(2)+" MB",R=e=>Array.from(e).map((e=>("0"+e.toString(16)).slice(-2))).join(""),F=e=>{const t=e.length/2,n=new Uint8Array(t);for(let a=0;a<t;a++)n[a]=parseInt(e.substring(2*a,2*a+2),16);return n},W=e=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõöøùúûüýþÿ¡¢£¤¥¦§¨©«®¯°±²³´µ¶·¸¹º¼½¾¿€©®™×÷ƒ∑∆∂∞≈≠≡≤≥⊂⊃∈∉√π∞∩∪⊥∧∨∩≈⊕⊗∫";let n="";for(let a=0;a<e;a++)n+=t.charAt(Math.floor(Math.random()*t.length));return n},j=()=>{D.disabled=!s.value&&!l||!A.value},q=()=>{L.disabled=!s.value&&!l||!A.value},B=()=>{l&&v._binaryData?(b.disabled=!1,g.disabled=!0):v.value?(b.disabled=!0,g.disabled=!1):(b.disabled=!0,g.disabled=!0)};s.addEventListener("input",(()=>{j(),q(),c.disabled=!s.value})),A.addEventListener("input",(()=>{j(),q(),M.disabled=!A.value})),u.addEventListener("change",(()=>{j(),q()})),v.addEventListener("input",B),D.onclick=async()=>{if(A.value)try{if(l&&s._binaryData){const e=s._binaryData,[t,n]=await(async(e,t)=>{const n=crypto.getRandomValues(new Uint8Array(12)),a=(new TextEncoder).encode(t),l=await crypto.subtle.digest("SHA-256",a),o=await crypto.subtle.importKey("raw",l,{name:"AES-GCM"},!1,["encrypt"]),r=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},o,e);return[new Uint8Array(r),n]})(e,A.value);v._binaryData=(e=>{const t=e.reduce(((e,t)=>e+t.length),0),n=new Uint8Array(t);let a=0;return e.forEach((e=>{n.set(e,a),a+=e.length})),n})([n,t]),v.value="_ENCRYPTED_BINARY_DATA_",v.disabled=!0,f.textContent=`Encrypted: ${T(v._binaryData.length)} (ready to download)`,b.disabled=!1,g.disabled=!0}else v.value=await(async(e,t)=>{const n=crypto.getRandomValues(new Uint8Array(12)),a=new TextEncoder,l=a.encode(t),o=await crypto.subtle.digest("SHA-256",l),r=await crypto.subtle.importKey("raw",o,{name:"AES-GCM"},!1,["encrypt"]),i=a.encode(e),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},r,i);return R(n)+":"+R(new Uint8Array(s))})(s.value,A.value),f.textContent="",b.disabled=!0,g.disabled=!1;B()}catch(e){f.textContent="Encryption failed."}else f.textContent="Please enter an encryption key."},L.onclick=async()=>{if(A.value)try{if(l&&s._binaryData){const e=s._binaryData,t=e.slice(0,12),n=e.slice(12),a=await(async(e,t,n)=>{const a=(new TextEncoder).encode(t),l=await crypto.subtle.digest("SHA-256",a),o=await crypto.subtle.importKey("raw",l,{name:"AES-GCM"},!1,["decrypt"]),r=await crypto.subtle.decrypt({name:"AES-GCM",iv:n},o,e);return new Uint8Array(r)})(n,A.value,t);v._binaryData=a,v.value="_DECRYPTED_BINARY_DATA_",v.disabled=!0,f.textContent=`Decrypted: ${T(a.length)} (ready to download)`,b.disabled=!1,g.disabled=!0}else v.value=await(async(e,t)=>{const[n,a]=e.split(":");if(!n||!a)throw new Error("Invalid encrypted message format");const l=F(n),o=F(a),r=(new TextEncoder).encode(t),i=await crypto.subtle.digest("SHA-256",r),s=await crypto.subtle.importKey("raw",i,{name:"AES-GCM"},!1,["decrypt"]),c=await crypto.subtle.decrypt({name:"AES-GCM",iv:l},s,o);return(new TextDecoder).decode(c)})(s.value,A.value),f.textContent="",b.disabled=!0,g.disabled=!1;B()}catch(e){f.textContent="Decryption failed. Make sure the input is valid and the encryption key is correct."}else f.textContent="Please enter an encryption key."}};let autoSaveIntervalId=null,isAutoSaveEnabled="true"===localStorage.getItem("autoSaveEnabled"),autoSaveInterval=parseInt(localStorage.getItem("autoSaveInterval"),10)||3e4,lastSaveTimestamp=Date.now(),countdownIntervalId=null;const saveData=()=>{const e={chatMessages:chatMessages,flashcards:flashcards,whiteboardData:window.whiteboardData,codeData:window.codeData,reminders:reminders,categories:channelCategories};localStorage.setItem("appData",JSON.stringify(e)),lastSaveTimestamp=Date.now()},startAutoSave=()=>{stopAutoSave(),autoSaveIntervalId=setInterval(saveData,autoSaveInterval)},stopAutoSave=()=>{autoSaveIntervalId&&(clearInterval(autoSaveIntervalId),autoSaveIntervalId=null)},startCountdownDisplay=e=>{stopCountdownDisplay(),countdownIntervalId=setInterval((()=>updateCountdownDisplay(e)),100)},stopCountdownDisplay=()=>{countdownIntervalId&&(clearInterval(countdownIntervalId),countdownIntervalId=null)},updateCountdownDisplay=e=>{if(isAutoSaveEnabled){const t=Date.now()-lastSaveTimestamp,n=Math.max(0,autoSaveInterval-t);e.textContent=`Auto-save in: ${(n/1e3).toFixed(1)}s`}else e.textContent="Auto-save in: --s"},renderSettingsChannel=(e,t)=>{e.innerHTML="";const n=createElement("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"flex-end",marginBottom:"var(--margin-small)"}}),a=createElement("button",{onclick:()=>{const e={chatMessages:chatMessages,flashcards:flashcards,whiteboardData:window.whiteboardData,codeData:window.codeData,reminders:reminders,categories:channelCategories};localStorage.setItem("appData",JSON.stringify(e)),alert("Data saved in localStorage."),y()}},"Save data"),l=createElement("button",{class:"remove-btn"},"Erase memory");(()=>{let e=!1;const t=t=>{t.preventDefault(),e?((()=>{localStorage.removeItem("appData"),localStorage.removeItem("autoSaveEnabled"),localStorage.removeItem("autoSaveInterval"),Object.keys(chatMessages).forEach((e=>delete chatMessages[e])),Object.keys(flashcards).forEach((e=>delete flashcards[e])),Object.keys(reminders).forEach((e=>delete reminders[e])),window.whiteboardData={},window.codeData={};const e=channelCategories.findIndex((e=>"Functions"===e.name));-1!==e&&(channelCategories.splice(e,1),renderSidebar()),isAutoSaveEnabled=!1,i.checked=!1,autoSaveInterval=3e4,c.value=autoSaveInterval,d.textContent=`Interval: ${autoSaveInterval/1e3}s`,stopAutoSave(),stopCountdownDisplay(),m.textContent="Auto-save in: --s",alert("Memory erased."),y()})(),l.textContent="Erase memory",l.classList.remove("confirm-btn"),e=!1):(l.textContent="Are you sure?",l.classList.add("confirm-btn"),e=!0)};l.removeEventListener("click",t),l.addEventListener("click",t);const n=t=>{t.target!==l&&e&&(l.textContent="Erase memory",l.classList.remove("confirm-btn"),e=!1)};document.removeEventListener("click",n),document.addEventListener("click",n)})(),n.appendChild(a),n.appendChild(l),e.appendChild(n);const o=createElement("div",{style:{display:"flex",alignItems:"center"}}),r=createElement("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center"}});e.appendChild(o),o.appendChild(r);const i=createElement("input",{type:"checkbox",checked:isAutoSaveEnabled,onchange:e=>{isAutoSaveEnabled=e.target.checked,localStorage.setItem("autoSaveEnabled",isAutoSaveEnabled),isAutoSaveEnabled?(saveData(),startAutoSave(),startCountdownDisplay(m)):(stopAutoSave(),stopCountdownDisplay(),m.textContent="Auto-save in: --s")}}),s=createElement("label",{style:{display:"flex",alignItems:"center",margin:"var(--margin-small)"}},"Auto Save: ",i),c=createElement("input",{type:"range",min:"1000",max:"60000",step:"1000",value:autoSaveInterval,oninput:e=>{autoSaveInterval=parseInt(e.target.value,10),localStorage.setItem("autoSaveInterval",autoSaveInterval),d.textContent=`Interval: ${autoSaveInterval/1e3}s`,isAutoSaveEnabled&&startAutoSave()}}),d=createElement("span",{style:{margin:"var(--margin-small)"}},`Interval: ${autoSaveInterval/1e3}s`),p=createElement("div",{style:{margin:"var(--margin-small)",display:"flex",alignItems:"center"}},c,d);r.appendChild(s),r.appendChild(p);const h=createElement("div",{style:{margin:"var(--margin-small)",color:"var(--color-text-muted)"}}),u=createElement("div"),m=createElement("div",{style:{margin:"var(--margin-small)",color:"var(--color-text-muted)"}},"Auto-save in: --s"),y=()=>{const e={chatMessages:chatMessages,flashcards:flashcards,whiteboardData:window.whiteboardData,codeData:window.codeData,reminders:reminders},t=JSON.stringify(e),n=new Blob([t]).size;if(navigator.storage&&navigator.storage.estimate)navigator.storage.estimate().then((e=>{const t=e.quota,a=n/t*100;u.style.width=a+"%",h.textContent=`Memory used: ${(n/1048576).toFixed(2)} MB (${a.toFixed(1)}% of ${(t/1048576).toFixed(2)} MB)`}));else{const e=102400,t=Math.min(100,n/e*100);u.style.width=t+"%",h.textContent=`Memory used: ${(n/1048576).toFixed(2)} MB (${t.toFixed(1)}% of ${(quota/1048576).toFixed(2)} MB)`}};h.appendChild(u),e.appendChild(h),e.appendChild(m),isAutoSaveEnabled&&startCountdownDisplay(m),y()},loadSavedData=()=>{const e=localStorage.getItem("appData");if(e)try{const t=JSON.parse(e);Object.assign(chatMessages,t.chatMessages||{}),Object.assign(flashcards,t.flashcards||{}),window.whiteboardData=t.whiteboardData||{},window.codeData=t.codeData||{},Object.assign(reminders,t.reminders||{}),t.categories&&channelCategories.splice(0,channelCategories.length,...t.categories)}catch{}isAutoSaveEnabled&&startAutoSave()};document.addEventListener("DOMContentLoaded",(()=>{loadSavedData(),renderSidebar(),channelCategories.length&&channelCategories[0].channels.length&&selectChannel(channelCategories[0].channels[0])}))})();